<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Financial Modeling Platform - Enhanced</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .module-card { background: white; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.07); transition: all 0.3s; }
        .module-card:hover { box-shadow: 0 10px 20px rgba(0,0,0,0.12); transform: translateY(-2px); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .metric-card { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 1.5rem; color: white; }
        input[type="number"], input[type="text"], input[type="date"], select, textarea { transition: all 0.2s; }
        input:focus, select:focus, textarea:focus { outline: none; ring: 2px; ring-color: #667eea; border-color: #667eea; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); transition: all 0.3s; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        function RealEstatePlatform() {
            // ========== MODULE 1: DEVELOPMENT PLAN ==========
            const [projectStart, setProjectStart] = useState('2025-01-01');
            const [projectName, setProjectName] = useState('Skyline Mixed-Use Development');
            const [preConstructionMonths, setPreConstructionMonths] = useState(6);
            const [constructionMonths, setConstructionMonths] = useState(24);
            const [operationsMonths, setOperationsMonths] = useState(60);
            
            const [landAcquisitionType, setLandAcquisitionType] = useState('cash');
            const [landValue, setLandValue] = useState(50000000);
            const [totalLandArea, setTotalLandArea] = useState(100000);
            const [gfa, setGfa] = useState(150000);
            const [bua, setBua] = useState(120000);
            const [residentialArea, setResidentialArea] = useState(60000);
            const [hospitalityArea, setHospitalityArea] = useState(30000);
            const [retailArea, setRetailArea] = useState(30000);
            
            // Enhanced Development Costs with phasing percentages
            const [devCosts, setDevCosts] = useState([
                { 
                    id: 1, 
                    name: 'Infrastructure Development', 
                    method: 'sqm', 
                    amount: 0, 
                    rate: 150, 
                    percentage: 0, 
                    startMonth: 1, 
                    endMonth: 6,
                    phasing: '30,25,20,15,7,3', // Custom % per month
                    residential: 40, 
                    hospitality: 30, 
                    retail: 30 
                },
                { 
                    id: 2, 
                    name: 'Construction - Residential', 
                    method: 'sqm', 
                    amount: 0, 
                    rate: 1200, 
                    percentage: 0, 
                    startMonth: 7, 
                    endMonth: 30,
                    phasing: '2,3,4,5,6,7,8,8,8,7,7,6,6,5,5,4,4,3,3,2,2,1,1,1', // S-curve
                    residential: 100, 
                    hospitality: 0, 
                    retail: 0 
                },
                { 
                    id: 3, 
                    name: 'Construction - Hospitality', 
                    method: 'sqm', 
                    amount: 0, 
                    rate: 1500, 
                    percentage: 0, 
                    startMonth: 7, 
                    endMonth: 30,
                    phasing: '2,3,4,5,6,7,8,8,8,7,7,6,6,5,5,4,4,3,3,2,2,1,1,1',
                    residential: 0, 
                    hospitality: 100, 
                    retail: 0 
                },
                { 
                    id: 4, 
                    name: 'Construction - Retail', 
                    method: 'sqm', 
                    amount: 0, 
                    rate: 1000, 
                    percentage: 0, 
                    startMonth: 7, 
                    endMonth: 30,
                    phasing: '2,3,4,5,6,7,8,8,8,7,7,6,6,5,5,4,4,3,3,2,2,1,1,1',
                    residential: 0, 
                    hospitality: 0, 
                    retail: 100 
                },
                { 
                    id: 5, 
                    name: 'Professional Fees', 
                    method: 'percentage', 
                    amount: 0, 
                    rate: 0, 
                    percentage: 5, 
                    startMonth: 1, 
                    endMonth: 30,
                    phasing: 'even', // Even distribution
                    residential: 40, 
                    hospitality: 30, 
                    retail: 30 
                },
                { 
                    id: 6, 
                    name: 'Government & Statutory', 
                    method: 'fixed', 
                    amount: 5000000, 
                    rate: 0, 
                    percentage: 0, 
                    startMonth: 1, 
                    endMonth: 12,
                    phasing: '40,30,15,5,3,2,2,1,1,0.5,0.5,0', // Front-loaded
                    residential: 40, 
                    hospitality: 30, 
                    retail: 30 
                },
                { 
                    id: 7, 
                    name: 'Pre-Operating Expenses', 
                    method: 'fixed', 
                    amount: 3000000, 
                    rate: 0, 
                    percentage: 0, 
                    startMonth: 25, 
                    endMonth: 30,
                    phasing: '10,15,20,25,20,10',
                    residential: 0, 
                    hospitality: 100, 
                    retail: 0 
                },
                { 
                    id: 8, 
                    name: 'Contingency', 
                    method: 'percentage', 
                    amount: 0, 
                    rate: 0, 
                    percentage: 5, 
                    startMonth: 1, 
                    endMonth: 30,
                    phasing: 'even',
                    residential: 40, 
                    hospitality: 30, 
                    retail: 30 
                }
            ]);
            
            const [debtPercentage, setDebtPercentage] = useState(60);
            const [interestRate, setInterestRate] = useState(7.5);
            const [interestCapitalized, setInterestCapitalized] = useState(true);
            const [debtDrawdownStart, setDebtDrawdownStart] = useState(7); // Start at construction
            const [investors, setInvestors] = useState([
                { id: 1, name: 'Investor A', equityPercentage: 60 },
                { id: 2, name: 'Investor B', equityPercentage: 40 }
            ]);

            // ========== MODULE 2: REVENUE & OPERATIONS ==========
            const [residentialUnits, setResidentialUnits] = useState(150);
            const [avgUnitSize, setAvgUnitSize] = useState(400);
            const [pricePerSqm, setPricePerSqm] = useState(3000);
            const [salesStartMonth, setSalesStartMonth] = useState(7);
            const [salesDuration, setSalesDuration] = useState(36);
            const [brokerageRate, setBrokerageRate] = useState(2);
            
            const [rentalUnits, setRentalUnits] = useState(50);
            const [avgRentalSize, setAvgRentalSize] = useState(350);
            const [monthlyRentPerSqm, setMonthlyRentPerSqm] = useState(15);
            const [occupancyRate, setOccupancyRate] = useState(85);
            const [rentalStartMonth, setRentalStartMonth] = useState(31);
            
            const [hotelRooms, setHotelRooms] = useState(200);
            const [adr, setAdr] = useState(250);
            const [hotelOccupancy, setHotelOccupancy] = useState(70);
            const [fbRevPerRoom, setFbRevPerRoom] = useState(50);
            const [otherRevPerRoom, setOtherRevPerRoom] = useState(30);
            const [hotelOpex, setHotelOpex] = useState(45);
            const [hotelStartMonth, setHotelStartMonth] = useState(31);
            
            const [retailUnits, setRetailUnits] = useState(40);
            const [avgRetailSize, setAvgRetailSize] = useState(750);
            const [rentPerSqmRetail, setRentPerSqmRetail] = useState(25);
            const [retailOccupancy, setRetailOccupancy] = useState(90);
            const [retailStartMonth, setRetailStartMonth] = useState(31);

            // ========== MODULE 3: VALUATION & EXIT ==========
            const [exitYear, setExitYear] = useState(5);
            const [residentialCapRate, setResidentialCapRate] = useState(6.5);
            const [hospitalityCapRate, setHospitalityCapRate] = useState(7.5);
            const [retailCapRate, setRetailCapRate] = useState(7.0);
            const [exitCosts, setExitCosts] = useState(2.5);
            const [discountRate, setDiscountRate] = useState(12);

            const [activeModule, setActiveModule] = useState('overview');
            const [activeTab, setActiveTab] = useState('timeline');

            // ========== ENHANCED CALCULATIONS ==========
            
            const calculateTotalDevCost = (cost, baseCosts) => {
                const totalArea = residentialArea + hospitalityArea + retailArea;
                
                if (cost.method === 'fixed') {
                    return cost.amount;
                } else if (cost.method === 'sqm') {
                    return cost.rate * totalArea;
                } else if (cost.method === 'percentage') {
                    const baseConstructionTotal = baseCosts.reduce((sum, bc) => sum + bc, 0);
                    return (cost.percentage / 100) * baseConstructionTotal;
                }
                return 0;
            };

            const parsePhasing = (phasingStr, numMonths) => {
                if (phasingStr === 'even' || !phasingStr) {
                    return Array(numMonths).fill(100 / numMonths);
                }
                const percentages = phasingStr.split(',').map(p => parseFloat(p.trim()));
                // Normalize to 100%
                const sum = percentages.reduce((a, b) => a + b, 0);
                return percentages.map(p => (p / sum) * 100);
            };

            const financialModel = useMemo(() => {
                const totalMonths = preConstructionMonths + constructionMonths + operationsMonths;
                
                // Calculate base construction costs
                const baseConstructionCosts = devCosts
                    .filter(c => c.method !== 'percentage')
                    .map(cost => calculateTotalDevCost(cost, []));
                
                const totalDevCosts = devCosts.map(cost => 
                    calculateTotalDevCost(cost, baseConstructionCosts)
                );
                
                const totalDevCost = totalDevCosts.reduce((sum, cost) => sum + cost, 0);
                const totalProjectCost = totalDevCost + (landAcquisitionType === 'cash' ? landValue : 0);
                
                const maxDebt = totalProjectCost * (debtPercentage / 100);
                const totalEquity = totalProjectCost - maxDebt;
                const landEquity = landAcquisitionType === 'inkind' ? landValue : 0;
                const cashEquity = totalEquity - landEquity;
                
                // Monthly Cash Flow with phased costs
                const monthlyCashFlow = [];
                let cumulativeDebt = 0;
                let cumulativeEquity = landEquity;
                let cumulativeRevenue = 0;
                let cumulativeOpex = 0;
                let cumulativeCashBalance = landEquity;
                
                // Track total assets and liabilities for Balance Sheet
                let totalAssets = 0;
                let totalLiabilities = 0;
                
                for (let month = 1; month <= totalMonths; month++) {
                    let monthlyDevCost = 0;
                    let monthlyRevenue = 0;
                    let monthlyOpex = 0;
                    
                    // Land acquisition in month 1
                    if (month === 1 && landAcquisitionType === 'cash') {
                        monthlyDevCost += landValue;
                    }
                    
                    // Development costs with custom phasing
                    devCosts.forEach((cost, idx) => {
                        if (month >= cost.startMonth && month <= cost.endMonth) {
                            const costTotal = totalDevCosts[idx];
                            const numMonths = cost.endMonth - cost.startMonth + 1;
                            const phasing = parsePhasing(cost.phasing, numMonths);
                            const monthIndex = month - cost.startMonth;
                            
                            if (monthIndex < phasing.length) {
                                monthlyDevCost += costTotal * (phasing[monthIndex] / 100);
                            }
                        }
                    });
                    
                    // Revenue calculations
                    if (month >= salesStartMonth && month < salesStartMonth + salesDuration) {
                        const totalSalesRevenue = residentialUnits * avgUnitSize * pricePerSqm;
                        const monthlySales = totalSalesRevenue / salesDuration;
                        const brokerage = monthlySales * (brokerageRate / 100);
                        monthlyRevenue += monthlySales;
                        monthlyOpex += brokerage;
                    }
                    
                    if (month >= rentalStartMonth) {
                        const monthlyRentalRev = rentalUnits * avgRentalSize * monthlyRentPerSqm * (occupancyRate / 100);
                        monthlyRevenue += monthlyRentalRev;
                        monthlyOpex += monthlyRentalRev * 0.03; // 3% property management
                    }
                    
                    if (month >= hotelStartMonth) {
                        const daysInMonth = 30;
                        const roomRevenue = hotelRooms * adr * daysInMonth * (hotelOccupancy / 100);
                        const fbRevenue = hotelRooms * fbRevPerRoom * daysInMonth * (hotelOccupancy / 100);
                        const otherRevenue = hotelRooms * otherRevPerRoom * daysInMonth * (hotelOccupancy / 100);
                        const totalHotelRev = roomRevenue + fbRevenue + otherRevenue;
                        const hotelOpexCost = totalHotelRev * (hotelOpex / 100);
                        
                        monthlyRevenue += totalHotelRev;
                        monthlyOpex += hotelOpexCost;
                    }
                    
                    if (month >= retailStartMonth) {
                        const retailRev = retailUnits * avgRetailSize * rentPerSqmRetail * (retailOccupancy / 100);
                        monthlyRevenue += retailRev;
                        monthlyOpex += retailRev * 0.02; // 2% property management
                    }
                    
                    // Debt drawdown based on period (starting at construction phase)
                    let debtDrawdown = 0;
                    if (month >= debtDrawdownStart && cumulativeDebt < maxDebt) {
                        const eligibleDebt = Math.min(monthlyDevCost * (debtPercentage / 100), maxDebt - cumulativeDebt);
                        debtDrawdown = eligibleDebt > 0 ? eligibleDebt : 0;
                        cumulativeDebt += debtDrawdown;
                    }
                    
                    // Interest calculation
                    const monthlyInterest = cumulativeDebt * (interestRate / 100 / 12);
                    if (interestCapitalized && month < rentalStartMonth) {
                        cumulativeDebt += monthlyInterest;
                    } else if (month >= rentalStartMonth) {
                        monthlyOpex += monthlyInterest;
                    }
                    
                    // Equity fills the funding gap
                    const cashNeeded = monthlyDevCost + monthlyOpex - monthlyRevenue - debtDrawdown;
                    const equityContribution = cashNeeded > 0 ? cashNeeded : 0;
                    cumulativeEquity += equityContribution;
                    
                    cumulativeRevenue += monthlyRevenue;
                    cumulativeOpex += monthlyOpex;
                    
                    const netCashFlow = monthlyRevenue - monthlyOpex - monthlyDevCost + debtDrawdown + equityContribution;
                    cumulativeCashBalance += netCashFlow;
                    
                    // Balance sheet items
                    totalAssets = cumulativeCashBalance + (landAcquisitionType === 'cash' ? landValue : 0) + 
                                  totalDevCosts.reduce((sum, cost) => sum + cost, 0);
                    totalLiabilities = cumulativeDebt;
                    
                    monthlyCashFlow.push({
                        month,
                        devCost: monthlyDevCost,
                        revenue: monthlyRevenue,
                        opex: monthlyOpex,
                        debtDrawdown,
                        interest: monthlyInterest,
                        equityContribution,
                        netCashFlow,
                        cumulativeDebt,
                        cumulativeEquity,
                        cumulativeRevenue,
                        cumulativeOpex,
                        cashBalance: cumulativeCashBalance,
                        totalAssets,
                        totalLiabilities
                    });
                }
                
                // Valuation & Exit
                const exitMonth = exitYear * 12;
                const annualResidentialRental = rentalUnits * avgRentalSize * monthlyRentPerSqm * 12 * (occupancyRate / 100);
                const annualHospitalityNOI = (hotelRooms * adr * 365 * (hotelOccupancy / 100) + 
                                             hotelRooms * fbRevPerRoom * 365 * (hotelOccupancy / 100) + 
                                             hotelRooms * otherRevPerRoom * 365 * (hotelOccupancy / 100)) * 
                                             (1 - hotelOpex / 100);
                const annualRetailRental = retailUnits * avgRetailSize * rentPerSqmRetail * 12 * (retailOccupancy / 100);
                
                const residentialValue = annualResidentialRental / (residentialCapRate / 100);
                const hospitalityValue = annualHospitalityNOI / (hospitalityCapRate / 100);
                const retailValue = annualRetailRental / (retailCapRate / 100);
                
                const totalExitValue = residentialValue + hospitalityValue + retailValue;
                const exitCostsAmount = totalExitValue * (exitCosts / 100);
                const netExitValue = totalExitValue - exitCostsAmount;
                
                const totalSalesRevenue = residentialUnits * avgUnitSize * pricePerSqm;
                
                // NPV & IRR calculation
                let npv = -totalProjectCost;
                monthlyCashFlow.forEach((cf, idx) => {
                    const yearFraction = (idx + 1) / 12;
                    npv += cf.netCashFlow / Math.pow(1 + discountRate / 100, yearFraction);
                });
                npv += netExitValue / Math.pow(1 + discountRate / 100, exitYear);
                
                const equityMultiple = (cumulativeRevenue - cumulativeOpex - totalDevCost + netExitValue - cumulativeDebt) / cumulativeEquity;
                
                // 5-Year Financial Statements
                const financialStatements = [];
                for (let year = 1; year <= 5; year++) {
                    const startMonth = (year - 1) * 12 + 1;
                    const endMonth = year * 12;
                    
                    const yearData = monthlyCashFlow.filter(cf => cf.month >= startMonth && cf.month <= endMonth);
                    
                    const yearRevenue = yearData.reduce((sum, cf) => sum + cf.revenue, 0);
                    const yearOpex = yearData.reduce((sum, cf) => sum + cf.opex, 0);
                    const yearDevCost = yearData.reduce((sum, cf) => sum + cf.devCost, 0);
                    const yearInterest = yearData.reduce((sum, cf) => sum + cf.interest, 0);
                    const yearDebtDraw = yearData.reduce((sum, cf) => sum + cf.debtDrawdown, 0);
                    const yearEquityDraw = yearData.reduce((sum, cf) => sum + cf.equityContribution, 0);
                    
                    const lastMonth = yearData[yearData.length - 1];
                    
                    financialStatements.push({
                        year,
                        // Income Statement
                        revenue: yearRevenue,
                        opex: yearOpex,
                        grossProfit: yearRevenue - yearOpex,
                        interest: yearInterest,
                        netIncome: yearRevenue - yearOpex - yearInterest,
                        
                        // Balance Sheet
                        cash: lastMonth ? lastMonth.cashBalance : 0,
                        propertyAssets: lastMonth ? yearDevCost : 0,
                        totalAssets: lastMonth ? lastMonth.totalAssets : 0,
                        debt: lastMonth ? lastMonth.cumulativeDebt : 0,
                        equity: lastMonth ? lastMonth.cumulativeEquity : 0,
                        totalLiabilities: lastMonth ? lastMonth.cumulativeDebt + lastMonth.cumulativeEquity : 0,
                        
                        // Cash Flow Statement
                        cashFromOperations: yearRevenue - yearOpex,
                        cashFromInvesting: -yearDevCost,
                        cashFromFinancing: yearDebtDraw + yearEquityDraw,
                        netCashFlow: yearRevenue - yearOpex - yearDevCost + yearDebtDraw + yearEquityDraw
                    });
                }
                
                return {
                    totalDevCost,
                    totalProjectCost,
                    maxDebt,
                    totalEquity,
                    landEquity,
                    cashEquity,
                    monthlyCashFlow,
                    totalDevCosts,
                    finalDebtBalance: cumulativeDebt,
                    finalEquityContributed: cumulativeEquity,
                    totalRevenue: cumulativeRevenue,
                    totalOpex: cumulativeOpex,
                    residentialValue,
                    hospitalityValue,
                    retailValue,
                    totalExitValue,
                    netExitValue,
                    npv,
                    equityMultiple,
                    totalSalesRevenue,
                    annualResidentialRental,
                    annualHospitalityNOI,
                    annualRetailRental,
                    financialStatements
                };
            }, [projectStart, preConstructionMonths, constructionMonths, operationsMonths,
                landAcquisitionType, landValue, residentialArea, hospitalityArea, retailArea,
                devCosts, debtPercentage, interestRate, interestCapitalized, debtDrawdownStart,
                residentialUnits, avgUnitSize, pricePerSqm, salesStartMonth, salesDuration,
                rentalUnits, avgRentalSize, monthlyRentPerSqm, occupancyRate, rentalStartMonth,
                hotelRooms, adr, hotelOccupancy, fbRevPerRoom, otherRevPerRoom, hotelOpex, hotelStartMonth,
                retailUnits, avgRetailSize, rentPerSqmRetail, retailOccupancy, retailStartMonth,
                exitYear, residentialCapRate, hospitalityCapRate, retailCapRate, exitCosts, discountRate,
                brokerageRate]);

            // Helper Functions
            const formatCurrency = (value) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(value);
            };

            const exportToCSV = () => {
                let csv = 'Month,Development Cost,Revenue,Operating Expenses,Debt Drawdown,Interest,Equity Contribution,Net Cash Flow,Cumulative Debt,Cumulative Equity,Cash Balance\n';
                financialModel.monthlyCashFlow.forEach(row => {
                    csv += `${row.month},${row.devCost.toFixed(2)},${row.revenue.toFixed(2)},${row.opex.toFixed(2)},${row.debtDrawdown.toFixed(2)},${row.interest.toFixed(2)},${row.equityContribution.toFixed(2)},${row.netCashFlow.toFixed(2)},${row.cumulativeDebt.toFixed(2)},${row.cumulativeEquity.toFixed(2)},${row.cashBalance.toFixed(2)}\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'financial_model_cashflow.csv';
                a.click();
            };

            const generatePDF = () => {
                window.print();
            };

            // CRUD Operations
            const addCost = () => {
                const newId = Math.max(...devCosts.map(c => c.id), 0) + 1;
                setDevCosts([...devCosts, {
                    id: newId, name: 'New Cost Item', method: 'fixed', amount: 0, rate: 0,
                    percentage: 0, startMonth: 1, endMonth: preConstructionMonths + constructionMonths,
                    phasing: 'even', residential: 40, hospitality: 30, retail: 30
                }]);
            };

            const updateCost = (id, field, value) => {
                setDevCosts(devCosts.map(cost => cost.id === id ? { ...cost, [field]: value } : cost));
            };

            const deleteCost = (id) => {
                setDevCosts(devCosts.filter(cost => cost.id !== id));
            };

            const addInvestor = () => {
                const newId = Math.max(...investors.map(i => i.id), 0) + 1;
                setInvestors([...investors, {
                    id: newId,
                    name: `Investor ${String.fromCharCode(65 + investors.length)}`,
                    equityPercentage: 0
                }]);
            };

            const updateInvestor = (id, field, value) => {
                setInvestors(investors.map(inv => inv.id === id ? { ...inv, [field]: value } : inv));
            };

            const deleteInvestor = (id) => {
                setInvestors(investors.filter(inv => inv.id !== id));
            };

            return (
                <div className="min-h-screen pb-12">
                    {/* Header */}
                    <div className="gradient-bg text-white py-8 px-6 shadow-lg no-print">
                        <div className="max-w-7xl mx-auto">
                            <h1 className="text-4xl font-bold mb-2">Real Estate Financial Modeling Platform</h1>
                            <p className="text-blue-100 text-lg">Complete Feasibility Analysis with 5-Year Financial Statements</p>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-6 mt-8">
                        {/* Module Selection - Overview */}
                        {activeModule === 'overview' && (
                            <div>
                                <h2 className="text-3xl font-bold mb-8 text-gray-800">Select Module</h2>
                                <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                    <div className="module-card p-6 cursor-pointer" onClick={() => setActiveModule('module1')}>
                                        <div className="text-4xl mb-4">üèóÔ∏è</div>
                                        <h3 className="text-xl font-bold mb-2 text-gray-800">Module 1</h3>
                                        <p className="text-gray-600 mb-4">Development Plan</p>
                                        <p className="text-sm text-gray-500">Timeline, land, costs & financing with phasing</p>
                                    </div>
                                    
                                    <div className="module-card p-6 cursor-pointer" onClick={() => setActiveModule('module2')}>
                                        <div className="text-4xl mb-4">üí∞</div>
                                        <h3 className="text-xl font-bold mb-2 text-gray-800">Module 2</h3>
                                        <p className="text-gray-600 mb-4">Revenue & Operations</p>
                                        <p className="text-sm text-gray-500">Sales, rentals, hospitality & retail</p>
                                    </div>
                                    
                                    <div className="module-card p-6 cursor-pointer" onClick={() => setActiveModule('module3')}>
                                        <div className="text-4xl mb-4">üìä</div>
                                        <h3 className="text-xl font-bold mb-2 text-gray-800">Module 3</h3>
                                        <p className="text-gray-600 mb-4">Valuation & Exit</p>
                                        <p className="text-sm text-gray-500">Asset valuation, cap rates & IRR</p>
                                    </div>
                                    
                                    <div className="module-card p-6 cursor-pointer" onClick={() => setActiveModule('module4')}>
                                        <div className="text-4xl mb-4">üìà</div>
                                        <h3 className="text-xl font-bold mb-2 text-gray-800">Module 4</h3>
                                        <p className="text-gray-600 mb-4">Financial Statements</p>
                                        <p className="text-sm text-gray-500">5-Year IS, BS, CF & Reports</p>
                                    </div>
                                </div>

                                {/* Quick Summary */}
                                <div className="module-card p-8">
                                    <h2 className="text-2xl font-bold mb-6 text-gray-800">Project Summary: {projectName}</h2>
                                    <div className="grid md:grid-cols-4 gap-6">
                                        <div>
                                            <p className="text-sm text-gray-600 mb-1">Total Project Cost</p>
                                            <p className="text-2xl font-bold text-gray-800">{formatCurrency(financialModel.totalProjectCost)}</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-600 mb-1">Expected Revenue</p>
                                            <p className="text-2xl font-bold text-green-600">{formatCurrency(financialModel.totalRevenue)}</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-600 mb-1">Exit Value</p>
                                            <p className="text-2xl font-bold text-purple-600">{formatCurrency(financialModel.netExitValue)}</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-600 mb-1">Equity Multiple</p>
                                            <p className="text-2xl font-bold text-blue-600">{financialModel.equityMultiple.toFixed(2)}x</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* MODULE 1 - Enhanced with Phasing */}
                        {activeModule === 'module1' && (
                            <div>
                                <div className="flex items-center justify-between mb-6 no-print">
                                    <button onClick={() => setActiveModule('overview')} className="text-blue-600 hover:text-blue-800 font-medium">
                                        ‚Üê Back to Overview
                                    </button>
                                    <h2 className="text-3xl font-bold text-gray-800">Module 1: Development Plan</h2>
                                    <div></div>
                                </div>

                                <div className="bg-white rounded-lg shadow-sm mb-6 no-print">
                                    <div className="flex border-b overflow-x-auto">
                                        {['timeline', 'land', 'costs', 'financing'].map(tab => (
                                            <button
                                                key={tab}
                                                onClick={() => setActiveTab(tab)}
                                                className={`px-6 py-4 font-medium transition-all whitespace-nowrap ${
                                                    activeTab === tab ? 'tab-active' : 'text-gray-600 hover:text-blue-600'
                                                }`}
                                            >
                                                {tab === 'timeline' && 'üìÖ Timeline'}
                                                {tab === 'land' && 'üèóÔ∏è Land & Area'}
                                                {tab === 'costs' && 'üí∞ Development Costs'}
                                                {tab === 'financing' && 'üè¶ Financing'}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {activeTab === 'costs' && (
                                    <div className="module-card p-6">
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-2xl font-bold text-gray-800">Development Costs with Phasing</h3>
                                            <button onClick={addCost} className="btn-primary text-white px-4 py-2 rounded-lg">
                                                + Add Cost Item
                                            </button>
                                        </div>

                                        <div className="mb-4 p-4 bg-blue-50 rounded-lg text-sm text-blue-800">
                                            <strong>Phasing Guide:</strong> Enter comma-separated percentages (e.g., "30,25,20,15,10") or "even" for equal distribution. 
                                            Total should equal 100%. This controls monthly spend distribution.
                                        </div>

                                        <div className="space-y-4">
                                            {devCosts.map(cost => (
                                                <div key={cost.id} className="border border-gray-200 rounded-lg p-4 bg-gray-50">
                                                    <div className="grid md:grid-cols-3 gap-4 mb-3">
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">Cost Item Name</label>
                                                            <input
                                                                type="text"
                                                                value={cost.name}
                                                                onChange={(e) => updateCost(cost.id, 'name', e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">Calculation Method</label>
                                                            <select
                                                                value={cost.method}
                                                                onChange={(e) => updateCost(cost.id, 'method', e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                                            >
                                                                <option value="fixed">Fixed Amount</option>
                                                                <option value="sqm">Rate per SQM</option>
                                                                <option value="percentage">% of Base Costs</option>
                                                            </select>
                                                        </div>
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">Value</label>
                                                            {cost.method === 'fixed' && (
                                                                <input type="number" value={cost.amount} 
                                                                    onChange={(e) => updateCost(cost.id, 'amount', Number(e.target.value))}
                                                                    className="w-full px-3 py-2 border border-gray-300 rounded text-sm" 
                                                                    placeholder="Amount ($)" />
                                                            )}
                                                            {cost.method === 'sqm' && (
                                                                <input type="number" value={cost.rate}
                                                                    onChange={(e) => updateCost(cost.id, 'rate', Number(e.target.value))}
                                                                    className="w-full px-3 py-2 border border-gray-300 rounded text-sm" 
                                                                    placeholder="$/sqm" />
                                                            )}
                                                            {cost.method === 'percentage' && (
                                                                <input type="number" value={cost.percentage}
                                                                    onChange={(e) => updateCost(cost.id, 'percentage', Number(e.target.value))}
                                                                    className="w-full px-3 py-2 border border-gray-300 rounded text-sm" 
                                                                    placeholder="%" />
                                                            )}
                                                        </div>
                                                    </div>
                                                    <div className="grid md:grid-cols-3 gap-4">
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">Start Month</label>
                                                            <input type="number" value={cost.startMonth}
                                                                onChange={(e) => updateCost(cost.id, 'startMonth', Number(e.target.value))}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded text-sm" min="1" />
                                                        </div>
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">End Month</label>
                                                            <input type="number" value={cost.endMonth}
                                                                onChange={(e) => updateCost(cost.id, 'endMonth', Number(e.target.value))}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded text-sm" min="1" />
                                                        </div>
                                                        <div className="flex items-end">
                                                            <button onClick={() => deleteCost(cost.id)}
                                                                className="w-full px-3 py-2 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                                                                üóëÔ∏è Delete
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div className="mt-3">
                                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                                            Phasing (% per month or "even")
                                                        </label>
                                                        <input
                                                            type="text"
                                                            value={cost.phasing}
                                                            onChange={(e) => updateCost(cost.id, 'phasing', e.target.value)}
                                                            className="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                                            placeholder="e.g., 30,25,20,15,10 or even"
                                                        />
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'financing' && (
                                    <div className="space-y-6">
                                        <div className="module-card p-6">
                                            <h3 className="text-2xl font-bold mb-6 text-gray-800">Capital Structure</h3>
                                            <div className="grid md:grid-cols-2 gap-6">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Debt Percentage (%)</label>
                                                    <input
                                                        type="number"
                                                        value={debtPercentage}
                                                        onChange={(e) => setDebtPercentage(Number(e.target.value))}
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                                        min="0" max="100" step="0.1"
                                                    />
                                                    <p className="text-sm text-gray-500 mt-1">Equity: {(100 - debtPercentage).toFixed(1)}%</p>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Interest Rate (% p.a.)</label>
                                                    <input
                                                        type="number"
                                                        value={interestRate}
                                                        onChange={(e) => setInterestRate(Number(e.target.value))}
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                                        min="0" step="0.1"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Debt Drawdown Start Month</label>
                                                    <input
                                                        type="number"
                                                        value={debtDrawdownStart}
                                                        onChange={(e) => setDebtDrawdownStart(Number(e.target.value))}
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                                        min="1"
                                                    />
                                                    <p className="text-sm text-gray-500 mt-1">Typically starts at construction phase (month 7)</p>
                                                </div>
                                                <div>
                                                    <label className="flex items-center space-x-2 mt-8">
                                                        <input
                                                            type="checkbox"
                                                            checked={interestCapitalized}
                                                            onChange={(e) => setInterestCapitalized(e.target.checked)}
                                                            className="w-4 h-4 text-blue-600"
                                                        />
                                                        <span className="text-sm font-medium text-gray-700">Capitalize Interest During Construction</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="module-card p-6">
                                            <div className="flex justify-between items-center mb-6">
                                                <h3 className="text-2xl font-bold text-gray-800">Equity Investors</h3>
                                                <button onClick={addInvestor} className="btn-primary text-white px-4 py-2 rounded-lg">
                                                    + Add Investor
                                                </button>
                                            </div>
                                            <div className="space-y-4">
                                                {investors.map(inv => (
                                                    <div key={inv.id} className="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                                        <input
                                                            type="text"
                                                            value={inv.name}
                                                            onChange={(e) => updateInvestor(inv.id, 'name', e.target.value)}
                                                            className="flex-1 px-4 py-2 border border-gray-300 rounded-lg"
                                                            placeholder="Investor Name"
                                                        />
                                                        <input
                                                            type="number"
                                                            value={inv.equityPercentage}
                                                            onChange={(e) => updateInvestor(inv.id, 'equityPercentage', Number(e.target.value))}
                                                            className="w-32 px-4 py-2 border border-gray-300 rounded-lg"
                                                            placeholder="%" min="0" max="100" step="0.1"
                                                        />
                                                        <span className="text-gray-600">%</span>
                                                        <button onClick={() => deleteInvestor(inv.id)}
                                                            className="text-red-600 hover:text-red-800">üóëÔ∏è</button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Keep other tabs from previous version */}
                            </div>
                        )}

                        {/* MODULE 4: Enhanced with 5-Year Financial Statements */}
                        {activeModule === 'module4' && (
                            <div>
                                <div className="flex items-center justify-between mb-6 no-print">
                                    <button onClick={() => setActiveModule('overview')} className="text-blue-600 hover:text-blue-800 font-medium">
                                        ‚Üê Back to Overview
                                    </button>
                                    <h2 className="text-3xl font-bold text-gray-800">Module 4: Financial Statements & Reports</h2>
                                    <div className="flex gap-2">
                                        <button onClick={exportToCSV} className="btn-primary text-white px-4 py-2 rounded-lg text-sm">
                                            üì• Export CSV
                                        </button>
                                        <button onClick={generatePDF} className="btn-primary text-white px-4 py-2 rounded-lg text-sm">
                                            üìÑ Print Report
                                        </button>
                                    </div>
                                </div>

                                {/* 5-Year Income Statement */}
                                <div className="module-card p-6 mb-6">
                                    <h3 className="text-2xl font-bold mb-4 text-gray-800">5-Year Income Statement</h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead className="bg-gray-800 text-white">
                                                <tr>
                                                    <th className="px-4 py-3 text-left">Line Item</th>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <th key={stmt.year} className="px-4 py-3 text-right">Year {stmt.year}</th>
                                                    ))}
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-200">
                                                <tr className="bg-blue-50 font-semibold">
                                                    <td className="px-4 py-3">REVENUE</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right text-green-600">
                                                            {formatCurrency(stmt.revenue)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="hover:bg-gray-50">
                                                    <td className="px-4 py-3">Operating Expenses</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right text-red-600">
                                                            ({formatCurrency(stmt.opex)})
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="bg-green-50 font-semibold">
                                                    <td className="px-4 py-3">Gross Profit</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.grossProfit)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="hover:bg-gray-50">
                                                    <td className="px-4 py-3">Interest Expense</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right text-red-600">
                                                            ({formatCurrency(stmt.interest)})
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="bg-blue-100 font-bold">
                                                    <td className="px-4 py-3">NET INCOME</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.netIncome)}
                                                        </td>
                                                    ))}
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* 5-Year Balance Sheet */}
                                <div className="module-card p-6 mb-6">
                                    <h3 className="text-2xl font-bold mb-4 text-gray-800">5-Year Balance Sheet</h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead className="bg-gray-800 text-white">
                                                <tr>
                                                    <th className="px-4 py-3 text-left">Line Item</th>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <th key={stmt.year} className="px-4 py-3 text-right">Year {stmt.year}</th>
                                                    ))}
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-200">
                                                <tr className="bg-blue-50 font-semibold">
                                                    <td className="px-4 py-3">ASSETS</td>
                                                    <td colSpan={5}></td>
                                                </tr>
                                                <tr className="hover:bg-gray-50">
                                                    <td className="px-4 py-3 pl-8">Cash & Cash Equivalents</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.cash)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="hover:bg-gray-50">
                                                    <td className="px-4 py-3 pl-8">Property & Development Assets</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.propertyAssets)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="bg-green-50 font-bold">
                                                    <td className="px-4 py-3">TOTAL ASSETS</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.totalAssets)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="bg-orange-50 font-semibold">
                                                    <td className="px-4 py-3">LIABILITIES</td>
                                                    <td colSpan={5}></td>
                                                </tr>
                                                <tr className="hover:bg-gray-50">
                                                    <td className="px-4 py-3 pl-8">Debt</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.debt)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="bg-purple-50 font-semibold">
                                                    <td className="px-4 py-3">EQUITY</td>
                                                    <td colSpan={5}></td>
                                                </tr>
                                                <tr className="hover:bg-gray-50">
                                                    <td className="px-4 py-3 pl-8">Total Equity</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.equity)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="bg-blue-100 font-bold">
                                                    <td className="px-4 py-3">TOTAL LIABILITIES & EQUITY</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.totalLiabilities)}
                                                        </td>
                                                    ))}
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* 5-Year Cash Flow Statement */}
                                <div className="module-card p-6 mb-6">
                                    <h3 className="text-2xl font-bold mb-4 text-gray-800">5-Year Cash Flow Statement</h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead className="bg-gray-800 text-white">
                                                <tr>
                                                    <th className="px-4 py-3 text-left">Line Item</th>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <th key={stmt.year} className="px-4 py-3 text-right">Year {stmt.year}</th>
                                                    ))}
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-200">
                                                <tr className="bg-green-50 font-semibold">
                                                    <td className="px-4 py-3">Cash from Operations</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.cashFromOperations)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="bg-orange-50 font-semibold">
                                                    <td className="px-4 py-3">Cash from Investing (Development)</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right text-red-600">
                                                            {formatCurrency(stmt.cashFromInvesting)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="bg-blue-50 font-semibold">
                                                    <td className="px-4 py-3">Cash from Financing (Debt & Equity)</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.cashFromFinancing)}
                                                        </td>
                                                    ))}
                                                </tr>
                                                <tr className="bg-gray-800 text-white font-bold">
                                                    <td className="px-4 py-3">NET CASH FLOW</td>
                                                    {financialModel.financialStatements.map(stmt => (
                                                        <td key={stmt.year} className="px-4 py-3 text-right">
                                                            {formatCurrency(stmt.netCashFlow)}
                                                        </td>
                                                    ))}
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* Monthly Cash Flow Sample */}
                                <div className="module-card p-6">
                                    <h3 className="text-xl font-bold mb-4 text-gray-800">Monthly Cash Flow Schedule (Sample - First 24 Months)</h3>
                                    <div className="overflow-x-auto max-h-96 overflow-y-auto">
                                        <table className="w-full text-xs">
                                            <thead className="bg-gray-50 sticky top-0">
                                                <tr>
                                                    <th className="px-2 py-2 text-left font-medium text-gray-700">Month</th>
                                                    <th className="px-2 py-2 text-right font-medium text-gray-700">Dev Cost</th>
                                                    <th className="px-2 py-2 text-right font-medium text-gray-700">Revenue</th>
                                                    <th className="px-2 py-2 text-right font-medium text-gray-700">Debt Draw</th>
                                                    <th className="px-2 py-2 text-right font-medium text-gray-700">Equity</th>
                                                    <th className="px-2 py-2 text-right font-medium text-gray-700">Cash Balance</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-200">
                                                {financialModel.monthlyCashFlow.slice(0, 24).map(row => (
                                                    <tr key={row.month} className="hover:bg-gray-50">
                                                        <td className="px-2 py-1">{row.month}</td>
                                                        <td className="px-2 py-1 text-right text-red-600">{formatCurrency(row.devCost)}</td>
                                                        <td className="px-2 py-1 text-right text-green-600">{formatCurrency(row.revenue)}</td>
                                                        <td className="px-2 py-1 text-right">{formatCurrency(row.debtDrawdown)}</td>
                                                        <td className="px-2 py-1 text-right">{formatCurrency(row.equityContribution)}</td>
                                                        <td className="px-2 py-1 text-right font-medium">{formatCurrency(row.cashBalance)}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<RealEstatePlatform />, document.getElementById('root'));
    </script>
</body>
</html>
