<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Financial Modeling Platform - Module 1 Complete</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-active { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
        }
        .module-card { 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.07); 
            transition: all 0.3s; 
        }
        .module-card:hover { 
            box-shadow: 0 10px 20px rgba(0,0,0,0.12); 
            transform: translateY(-2px); 
        }
        .gradient-bg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        input[type="number"], input[type="text"], input[type="date"], select { 
            transition: all 0.2s; 
        }
        input:focus, select:focus { 
            outline: none; 
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            transition: all 0.3s; 
        }
        .btn-primary:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); 
        }
        .table-container {
            overflow-x: auto;
            max-width: 100%;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            font-size: 0.875rem;
        }
        th {
            position: sticky;
            top: 0;
            background: #1f2937;
            color: white;
            font-weight: 600;
            padding: 0.75rem;
            text-align: center;
            border: 1px solid #374151;
        }
        td {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            text-align: right;
        }
        td:first-child {
            text-align: left;
            font-weight: 500;
            position: sticky;
            left: 0;
            background: white;
            z-index: 1;
        }
        .total-row {
            background: #e0e7ff;
            font-weight: 700;
        }
        .sticky-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* Input styling as per screenshot */
        .input-cell {
            background-color: #fef3c7 !important;
            color: #1e40af !important;
            font-weight: 600;
            border: 1px solid #fbbf24 !important;
        }
        .editable-name {
            background-color: #fef3c7;
            color: #1e40af;
            font-weight: 600;
            border: 1px solid #fbbf24;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #1f2937;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            line-height: 1.4;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        function RealEstatePlatform() {
            // State Management
            const [activeModule, setActiveModule] = useState('overview');
            const [activeTab, setActiveTab] = useState('timeline');
            
            // Timeline
            const [projectName, setProjectName] = useState('Skyline');
            const [projectType, setProjectType] = useState('mixed-use');
            const [country, setCountry] = useState('United States');
            const [currency, setCurrency] = useState('USD');
            const [modelType, setModelType] = useState('monthly');
            const [projectStart, setProjectStart] = useState('2025-01-01');
            const [constructionPeriods, setConstructionPeriods] = useState(24);
            const [operationsPeriods, setOperationsPeriods] = useState(60);
            
            // Handle model type change with auto-conversion
            const handleModelTypeChange = (newType) => {
                if (modelType === 'monthly' && newType === 'annual') {
                    // Convert from monthly to annual
                    setConstructionPeriods(Math.round(constructionPeriods / 12));
                    setOperationsPeriods(Math.round(operationsPeriods / 12));
                } else if (modelType === 'annual' && newType === 'monthly') {
                    // Convert from annual to monthly
                    setConstructionPeriods(constructionPeriods * 12);
                    setOperationsPeriods(operationsPeriods * 12);
                }
                setModelType(newType);
            };

            // Land Area States
            const [totalLand, setTotalLand] = useState(50000);
            const [landUnit, setLandUnit] = useState('sqm');
            const [setbackArea, setSetbackArea] = useState(5000);
            const [openSpaceArea, setOpenSpaceArea] = useState(7500);

            // Enhanced component structure with editable names and add/remove functionality
            const [components, setComponents] = useState([
                {
                    id: 'residential',
                    name: 'Residential',
                    color: 'blue',
                    lines: [
                        { id: 'gfa', label: 'GFA (Gross Floor Area)', multiplier: 'netDevelopable', value: 2.5, areaType: 'multiplier' },
                        { id: 'bua', label: 'BUA (Built Up Area)', multiplier: 'gfa', value: 0.85, areaType: 'percentage' },
                        { id: 'saleable', label: 'Saleable Area', multiplier: 'bua', value: 0.75, areaType: 'percentage' }
                    ]
                },
                {
                    id: 'commercial',
                    name: 'Commercial',
                    color: 'orange',
                    lines: [
                        { id: 'gfa', label: 'GFA (Gross Floor Area)', multiplier: 'netDevelopable', value: 1.8, areaType: 'multiplier' },
                        { id: 'bua', label: 'BUA (Built Up Area)', multiplier: 'gfa', value: 0.90, areaType: 'percentage' },
                        { id: 'saleable', label: 'Saleable Area', multiplier: 'bua', value: 0.80, areaType: 'percentage' }
                    ]
                },
                {
                    id: 'hospitality',
                    name: 'Hospitality',
                    color: 'green',
                    lines: [
                        { id: 'gfa', label: 'GFA (Gross Floor Area)', multiplier: 'netDevelopable', value: 1.5, areaType: 'multiplier' },
                        { id: 'bua', label: 'BUA (Built Up Area)', multiplier: 'gfa', value: 0.88, areaType: 'percentage' }
                    ]
                },
                {
                    id: 'retail',
                    name: 'Retail',
                    color: 'purple',
                    lines: [
                        { id: 'gfa', label: 'GFA (Gross Floor Area)', multiplier: 'netDevelopable', value: 1.2, areaType: 'multiplier' },
                        { id: 'bua', label: 'BUA (Built Up Area)', multiplier: 'gfa', value: 0.92, areaType: 'percentage' }
                    ]
                }
            ]);

            // Update component name
            const updateComponentName = (componentId, newName) => {
                setComponents(components.map(comp => 
                    comp.id === componentId ? { ...comp, name: newName } : comp
                ));
            };

            // Add new line to component
            const addLineToComponent = (componentId) => {
                setComponents(components.map(comp => {
                    if (comp.id === componentId) {
                        const newLine = {
                            id: `custom_${Date.now()}`,
                            label: 'New Line',
                            multiplier: 'netDevelopable',
                            value: 1.0,
                            areaType: 'multiplier'
                        };
                        return { ...comp, lines: [...comp.lines, newLine] };
                    }
                    return comp;
                }));
            };

            // Remove line from component
            const removeLineFromComponent = (componentId, lineId) => {
                setComponents(components.map(comp => {
                    if (comp.id === componentId) {
                        return { ...comp, lines: comp.lines.filter(line => line.id !== lineId) };
                    }
                    return comp;
                }));
            };

            // Update line property
            const updateLine = (componentId, lineId, property, value) => {
                setComponents(components.map(comp => {
                    if (comp.id === componentId) {
                        return {
                            ...comp,
                            lines: comp.lines.map(line => 
                                line.id === lineId ? { ...line, [property]: value } : line
                            )
                        };
                    }
                    return comp;
                }));
            };

            // Land Distribution
            const [cashPercent, setCashPercent] = useState(20);
            const [equityPercent, setEquityPercent] = useState(40);
            const [debtPercent, setDebtPercent] = useState(60);

            // Calculations
            const netDevelopableArea = totalLand - setbackArea - openSpaceArea;
            
            // Calculate areas for each component based on their line definitions
            const calculateComponentAreas = (component) => {
                const areas = {};
                let previousValue = netDevelopableArea;

                component.lines.forEach((line, index) => {
                    let calculatedValue = 0;
                    
                    if (index === 0) {
                        // First line - multiply base area by FAR/multiplier
                        const baseArea = line.multiplier === 'totalLand' ? totalLand :
                                        line.multiplier === 'netDevelopable' ? netDevelopableArea :
                                        line.multiplier === 'setback' ? setbackArea :
                                        line.multiplier === 'openSpace' ? openSpaceArea : netDevelopableArea;
                        
                        if (line.areaType === 'multiplier') {
                            calculatedValue = baseArea * line.value;
                        } else {
                            calculatedValue = baseArea * (line.value / 100);
                        }
                    } else {
                        // Subsequent lines - use previous line's value
                        const prevLine = component.lines[index - 1];
                        previousValue = areas[prevLine.id] || 0;
                        
                        if (line.areaType === 'percentage') {
                            calculatedValue = previousValue * (line.value / 100);
                        } else {
                            calculatedValue = previousValue * line.value;
                        }
                    }
                    
                    areas[line.id] = calculatedValue;
                });

                return areas;
            };

            // Get calculated values for display
            const getComponentCalculatedAreas = () => {
                const result = {};
                components.forEach(comp => {
                    result[comp.id] = calculateComponentAreas(comp);
                });
                return result;
            };

            const calculatedAreas = getComponentCalculatedAreas();

            // Helper function for number formatting
            const formatNumber = (num) => {
                return new Intl.NumberFormat('en-US', { 
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 2 
                }).format(num);
            };

            // Get formula display text
            const getFormulaText = (component, line, lineIndex) => {
                if (lineIndex === 0) {
                    const baseAreaName = line.multiplier === 'totalLand' ? 'Total Land' :
                                        line.multiplier === 'netDevelopable' ? 'Net Developable Area' :
                                        line.multiplier === 'setback' ? 'Setback Area' :
                                        line.multiplier === 'openSpace' ? 'Open Space' : 'Net Developable Area';
                    
                    if (line.areaType === 'multiplier') {
                        return `${baseAreaName} √ó ${line.value}`;
                    } else {
                        return `${baseAreaName} √ó ${line.value}%`;
                    }
                } else {
                    const prevLine = component.lines[lineIndex - 1];
                    if (line.areaType === 'percentage') {
                        return `${prevLine.label} √ó ${line.value}%`;
                    } else {
                        return `${prevLine.label} √ó ${line.value}`;
                    }
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="gradient-bg text-white p-6 shadow-lg">
                        <div className="max-w-7xl mx-auto">
                            <h1 className="text-3xl font-bold mb-2">Real Estate Financial Modeling Platform</h1>
                            <p className="text-blue-100">Project: {projectName} | Type: {projectType} | Currency: {currency}</p>
                        </div>
                    </div>

                    {/* Module Navigation */}
                    <div className="sticky-nav bg-white border-b">
                        <div className="max-w-7xl mx-auto px-6 py-4">
                            <div className="flex gap-4 overflow-x-auto">
                                {['overview', 'landArea', 'devCosts', 'financing', 'cashflow'].map((module) => (
                                    <button
                                        key={module}
                                        onClick={() => setActiveModule(module)}
                                        className={`px-6 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${
                                            activeModule === module 
                                                ? 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg' 
                                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                        }`}
                                    >
                                        {module === 'overview' ? 'üìä Overview' :
                                         module === 'landArea' ? 'üèóÔ∏è Land & Area' :
                                         module === 'devCosts' ? 'üí∞ Dev Costs' :
                                         module === 'financing' ? 'üè¶ Financing' :
                                         'üíµ Cashflow'}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Content Area */}
                    {activeModule === 'overview' && (
                        <div className="max-w-7xl mx-auto p-6">
                            <div className="module-card p-8">
                                <h2 className="text-2xl font-bold mb-6 text-gray-800">Project Dashboard</h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white">
                                        <div className="text-sm opacity-90">Total Land Area</div>
                                        <div className="text-3xl font-bold mt-2">{formatNumber(totalLand)} {landUnit}</div>
                                    </div>
                                    <div className="bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-xl text-white">
                                        <div className="text-sm opacity-90">Net Developable</div>
                                        <div className="text-3xl font-bold mt-2">{formatNumber(netDevelopableArea)} {landUnit}</div>
                                    </div>
                                    <div className="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-xl text-white">
                                        <div className="text-sm opacity-90">Development Period</div>
                                        <div className="text-3xl font-bold mt-2">{constructionPeriods} {modelType === 'monthly' ? 'months' : 'years'}</div>
                                    </div>
                                </div>

                                <div className="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* Timeline Card */}
                                    <div className="bg-white border-2 border-gray-200 rounded-xl p-6">
                                        <h3 className="font-bold text-lg mb-4 text-gray-800">üìÖ Project Timeline</h3>
                                        <div className="space-y-3">
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Start Date:</span>
                                                <span className="font-semibold">{projectStart}</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Construction:</span>
                                                <span className="font-semibold">{constructionPeriods} {modelType === 'monthly' ? 'months' : 'years'}</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Operations:</span>
                                                <span className="font-semibold">{operationsPeriods} {modelType === 'monthly' ? 'months' : 'years'}</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Financial Structure Card */}
                                    <div className="bg-white border-2 border-gray-200 rounded-xl p-6">
                                        <h3 className="font-bold text-lg mb-4 text-gray-800">üíº Financial Structure</h3>
                                        <div className="space-y-3">
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Cash/Land:</span>
                                                <span className="font-semibold">{cashPercent}%</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Equity:</span>
                                                <span className="font-semibold text-green-600">{equityPercent}%</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Debt:</span>
                                                <span className="font-semibold text-red-600">{debtPercent}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeModule === 'landArea' && (
                        <div className="max-w-7xl mx-auto p-6">
                            <div className="module-card p-8">
                                {/* Tab Navigation */}
                                <div className="flex gap-2 mb-6 border-b">
                                    {['timeline', 'landDetails', 'distribution', 'financing'].map((tab) => (
                                        <button
                                            key={tab}
                                            onClick={() => setActiveTab(tab)}
                                            className={`px-6 py-3 font-semibold rounded-t-lg transition-all ${
                                                activeTab === tab 
                                                    ? 'tab-active' 
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                        >
                                            {tab === 'timeline' ? 'Timeline & Setup' :
                                             tab === 'landDetails' ? 'Land & Area Details' :
                                             tab === 'distribution' ? 'Land Distribution' :
                                             'Financing Sources'}
                                        </button>
                                    ))}
                                </div>

                                {/* Timeline & Setup Tab */}
                                {activeTab === 'timeline' && (
                                    <div className="space-y-6">
                                        <h2 className="text-2xl font-bold text-gray-800">Project Timeline & Setup</h2>
                                        
                                        {/* Basic Info */}
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <label className="block text-sm font-semibold mb-2 text-gray-700">Project Name</label>
                                                <input
                                                    type="text"
                                                    value={projectName}
                                                    onChange={(e) => setProjectName(e.target.value)}
                                                    className="input-cell w-full px-4 py-2 rounded-lg"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-semibold mb-2 text-gray-700">Project Type</label>
                                                <select
                                                    value={projectType}
                                                    onChange={(e) => setProjectType(e.target.value)}
                                                    className="input-cell w-full px-4 py-2 rounded-lg"
                                                >
                                                    <option value="residential">Residential</option>
                                                    <option value="commercial">Commercial</option>
                                                    <option value="mixed-use">Mixed-Use</option>
                                                    <option value="industrial">Industrial</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-semibold mb-2 text-gray-700">Country</label>
                                                <select
                                                    value={country}
                                                    onChange={(e) => setCountry(e.target.value)}
                                                    className="input-cell w-full px-4 py-2 rounded-lg"
                                                >
                                                    <option value="United States">United States</option>
                                                    <option value="United Kingdom">United Kingdom</option>
                                                    <option value="Canada">Canada</option>
                                                    <option value="Australia">Australia</option>
                                                    <option value="UAE">UAE</option>
                                                    <option value="Singapore">Singapore</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-semibold mb-2 text-gray-700">Currency</label>
                                                <select
                                                    value={currency}
                                                    onChange={(e) => setCurrency(e.target.value)}
                                                    className="input-cell w-full px-4 py-2 rounded-lg"
                                                >
                                                    <option value="USD">USD ($)</option>
                                                    <option value="GBP">GBP (¬£)</option>
                                                    <option value="EUR">EUR (‚Ç¨)</option>
                                                    <option value="AED">AED (ÿØ.ÿ•)</option>
                                                    <option value="SGD">SGD (S$)</option>
                                                </select>
                                            </div>
                                        </div>

                                        {/* Model Configuration */}
                                        <div className="bg-blue-50 p-6 rounded-lg">
                                            <h3 className="font-bold text-lg mb-4 text-gray-800">Model Configuration</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Model Type</label>
                                                    <select
                                                        value={modelType}
                                                        onChange={(e) => handleModelTypeChange(e.target.value)}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                    >
                                                        <option value="monthly">Monthly</option>
                                                        <option value="annual">Annual</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Project Start Date</label>
                                                    <input
                                                        type="date"
                                                        value={projectStart}
                                                        onChange={(e) => setProjectStart(e.target.value)}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                    />
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">
                                                        Construction Period ({modelType === 'monthly' ? 'months' : 'years'})
                                                    </label>
                                                    <input
                                                        type="number"
                                                        value={constructionPeriods}
                                                        onChange={(e) => setConstructionPeriods(Number(e.target.value))}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                        min="1"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">
                                                        Operations Period ({modelType === 'monthly' ? 'months' : 'years'})
                                                    </label>
                                                    <input
                                                        type="number"
                                                        value={operationsPeriods}
                                                        onChange={(e) => setOperationsPeriods(Number(e.target.value))}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                        min="1"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Land & Area Details Tab */}
                                {activeTab === 'landDetails' && (
                                    <div className="space-y-6">
                                        <div className="flex justify-between items-center">
                                            <h2 className="text-2xl font-bold text-gray-800">Land & Area Details</h2>
                                            <div className="text-sm text-gray-600">
                                                <span className="bg-yellow-100 text-blue-700 px-3 py-1 rounded">Yellow = Input Fields</span>
                                            </div>
                                        </div>

                                        {/* Base Land Information */}
                                        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border-2 border-blue-200">
                                            <h3 className="font-bold text-lg mb-4 text-gray-800">Base Land Information</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Total Land Area</label>
                                                    <input
                                                        type="number"
                                                        value={totalLand}
                                                        onChange={(e) => setTotalLand(Number(e.target.value))}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Unit of Measurement</label>
                                                    <select
                                                        value={landUnit}
                                                        onChange={(e) => setLandUnit(e.target.value)}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                    >
                                                        <option value="sqm">Square Meters (sqm)</option>
                                                        <option value="sqft">Square Feet (sqft)</option>
                                                        <option value="acres">Acres</option>
                                                        <option value="hectares">Hectares</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Net Developable Area</label>
                                                    <div className="bg-white px-4 py-2 rounded-lg border-2 border-gray-300 text-gray-700 font-semibold">
                                                        {formatNumber(netDevelopableArea)} {landUnit}
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Setback Area</label>
                                                    <input
                                                        type="number"
                                                        value={setbackArea}
                                                        onChange={(e) => setSetbackArea(Number(e.target.value))}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Open Space Area</label>
                                                    <input
                                                        type="number"
                                                        value={openSpaceArea}
                                                        onChange={(e) => setOpenSpaceArea(Number(e.target.value))}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Component Area Calculations */}
                                        {components.map((component, compIndex) => {
                                            const areas = calculatedAreas[component.id];
                                            
                                            return (
                                                <div key={component.id} className={`bg-${component.color}-50 p-6 rounded-xl border-2 border-${component.color}-200`}>
                                                    <div className="flex justify-between items-center mb-4">
                                                        <div className="flex items-center gap-3">
                                                            <input
                                                                type="text"
                                                                value={component.name}
                                                                onChange={(e) => updateComponentName(component.id, e.target.value)}
                                                                className="editable-name text-lg font-bold"
                                                            />
                                                        </div>
                                                        <button
                                                            onClick={() => addLineToComponent(component.id)}
                                                            className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all"
                                                        >
                                                            + Add Line
                                                        </button>
                                                    </div>

                                                    <div className="overflow-x-auto">
                                                        <table className="w-full bg-white rounded-lg overflow-hidden">
                                                            <thead>
                                                                <tr className="bg-gray-800 text-white">
                                                                    <th className="p-3 text-left">Description</th>
                                                                    <th className="p-3 text-center">
                                                                        <div className="tooltip">
                                                                            Base Area
                                                                            <span className="tooltiptext">
                                                                                Select which area to use as the base for calculation:
                                                                                <br/>‚Ä¢ Total Land: Full land parcel
                                                                                <br/>‚Ä¢ Net Developable: After setbacks & open space
                                                                                <br/>‚Ä¢ Setback Area: Reserved perimeter
                                                                                <br/>‚Ä¢ Open Space: Parks, amenities, etc.
                                                                            </span>
                                                                        </div>
                                                                    </th>
                                                                    <th className="p-3 text-center">
                                                                        <div className="tooltip">
                                                                            Multiplier/Value
                                                                            <span className="tooltiptext">
                                                                                For first line: FAR (Floor Area Ratio) - multiply base area by this number
                                                                                <br/>For other lines: Percentage or ratio to apply
                                                                            </span>
                                                                        </div>
                                                                    </th>
                                                                    <th className="p-3 text-center">Formula</th>
                                                                    <th className="p-3 text-right">Calculated Area ({landUnit})</th>
                                                                    <th className="p-3 text-center">Actions</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {component.lines.map((line, lineIndex) => (
                                                                    <tr key={line.id} className={lineIndex % 2 === 0 ? 'bg-gray-50' : 'bg-white'}>
                                                                        <td className="p-2 border">
                                                                            <input
                                                                                type="text"
                                                                                value={line.label}
                                                                                onChange={(e) => updateLine(component.id, line.id, 'label', e.target.value)}
                                                                                className="editable-name w-full"
                                                                            />
                                                                        </td>
                                                                        <td className="p-2 border text-center">
                                                                            {lineIndex === 0 ? (
                                                                                <select
                                                                                    value={line.multiplier}
                                                                                    onChange={(e) => updateLine(component.id, line.id, 'multiplier', e.target.value)}
                                                                                    className="input-cell w-full px-2 py-1 rounded text-sm"
                                                                                >
                                                                                    <option value="totalLand">Total Land</option>
                                                                                    <option value="netDevelopable">Net Developable</option>
                                                                                    <option value="setback">Setback Area</option>
                                                                                    <option value="openSpace">Open Space</option>
                                                                                </select>
                                                                            ) : (
                                                                                <div className="text-gray-600 text-sm">
                                                                                    {component.lines[lineIndex - 1].label}
                                                                                </div>
                                                                            )}
                                                                        </td>
                                                                        <td className="p-2 border text-center">
                                                                            <div className="flex items-center gap-2 justify-center">
                                                                                <input
                                                                                    type="number"
                                                                                    value={line.value}
                                                                                    onChange={(e) => updateLine(component.id, line.id, 'value', Number(e.target.value))}
                                                                                    step="0.1"
                                                                                    className="input-cell w-20 px-2 py-1 rounded text-center"
                                                                                />
                                                                                {lineIndex === 0 && (
                                                                                    <select
                                                                                        value={line.areaType}
                                                                                        onChange={(e) => updateLine(component.id, line.id, 'areaType', e.target.value)}
                                                                                        className="input-cell px-2 py-1 rounded text-sm"
                                                                                    >
                                                                                        <option value="multiplier">√ó (FAR)</option>
                                                                                        <option value="percentage">%</option>
                                                                                    </select>
                                                                                )}
                                                                                {lineIndex > 0 && (
                                                                                    <select
                                                                                        value={line.areaType}
                                                                                        onChange={(e) => updateLine(component.id, line.id, 'areaType', e.target.value)}
                                                                                        className="input-cell px-2 py-1 rounded text-sm"
                                                                                    >
                                                                                        <option value="percentage">%</option>
                                                                                        <option value="multiplier">√ó</option>
                                                                                    </select>
                                                                                )}
                                                                            </div>
                                                                        </td>
                                                                        <td className="p-2 border text-center text-sm text-gray-600 font-mono">
                                                                            {getFormulaText(component, line, lineIndex)}
                                                                        </td>
                                                                        <td className="p-2 border text-right font-semibold text-gray-800">
                                                                            {formatNumber(areas[line.id] || 0)}
                                                                        </td>
                                                                        <td className="p-2 border text-center">
                                                                            {component.lines.length > 1 && (
                                                                                <button
                                                                                    onClick={() => removeLineFromComponent(component.id, line.id)}
                                                                                    className="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs font-semibold transition-all"
                                                                                >
                                                                                    Remove
                                                                                </button>
                                                                            )}
                                                                        </td>
                                                                    </tr>
                                                                ))}
                                                            </tbody>
                                                        </table>
                                                    </div>

                                                    {/* Summary Row */}
                                                    <div className="mt-4 bg-white p-4 rounded-lg border-2 border-gray-300">
                                                        <div className="grid grid-cols-3 gap-4 text-center">
                                                            <div>
                                                                <div className="text-sm text-gray-600">Total GFA</div>
                                                                <div className="text-xl font-bold text-gray-800">
                                                                    {formatNumber(areas['gfa'] || 0)} {landUnit}
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div className="text-sm text-gray-600">Total BUA</div>
                                                                <div className="text-xl font-bold text-gray-800">
                                                                    {formatNumber(areas['bua'] || 0)} {landUnit}
                                                                </div>
                                                            </div>
                                                            {areas['saleable'] && (
                                                                <div>
                                                                    <div className="text-sm text-gray-600">Saleable Area</div>
                                                                    <div className="text-xl font-bold text-gray-800">
                                                                        {formatNumber(areas['saleable'] || 0)} {landUnit}
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}

                                        {/* FAR Explanation Box */}
                                        <div className="bg-blue-100 border-l-4 border-blue-500 p-4 rounded">
                                            <div className="flex">
                                                <div className="flex-shrink-0">
                                                    <svg className="h-5 w-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                                                        <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
                                                    </svg>
                                                </div>
                                                <div className="ml-3">
                                                    <p className="text-sm text-blue-700">
                                                        <strong>FAR (Floor Area Ratio):</strong> The ratio of total building floor area to the size of the land plot. 
                                                        For example, a FAR of 2.5 on 10,000 sqm means you can build up to 25,000 sqm of total floor area.
                                                        <br/><br/>
                                                        <strong>GFA (Gross Floor Area):</strong> Total floor area of all floors in the building.
                                                        <br/>
                                                        <strong>BUA (Built-Up Area):</strong> The actual constructed area excluding common areas.
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Land Distribution Tab */}
                                {activeTab === 'distribution' && (
                                    <div className="space-y-6">
                                        <h2 className="text-2xl font-bold text-gray-800">Land Distribution & Allocation</h2>

                                        {/* Area Breakdown */}
                                        <div className="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border-2 border-green-200">
                                            <h3 className="font-bold text-lg mb-4 text-gray-800">Area Allocation Summary</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                                <div className="bg-white p-4 rounded-lg shadow">
                                                    <div className="text-sm text-gray-600 mb-1">Total Land</div>
                                                    <div className="text-2xl font-bold text-gray-800">{formatNumber(totalLand)}</div>
                                                    <div className="text-xs text-gray-500">{landUnit}</div>
                                                </div>
                                                <div className="bg-white p-4 rounded-lg shadow">
                                                    <div className="text-sm text-gray-600 mb-1">Setback Area</div>
                                                    <div className="text-2xl font-bold text-orange-600">{formatNumber(setbackArea)}</div>
                                                    <div className="text-xs text-gray-500">{((setbackArea/totalLand)*100).toFixed(1)}% of total</div>
                                                </div>
                                                <div className="bg-white p-4 rounded-lg shadow">
                                                    <div className="text-sm text-gray-600 mb-1">Open Space</div>
                                                    <div className="text-2xl font-bold text-green-600">{formatNumber(openSpaceArea)}</div>
                                                    <div className="text-xs text-gray-500">{((openSpaceArea/totalLand)*100).toFixed(1)}% of total</div>
                                                </div>
                                                <div className="bg-white p-4 rounded-lg shadow">
                                                    <div className="text-sm text-gray-600 mb-1">Net Developable</div>
                                                    <div className="text-2xl font-bold text-blue-600">{formatNumber(netDevelopableArea)}</div>
                                                    <div className="text-xs text-gray-500">{((netDevelopableArea/totalLand)*100).toFixed(1)}% of total</div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Financing Structure */}
                                        <div className="bg-gradient-to-br from-purple-50 to-indigo-50 p-6 rounded-xl border-2 border-purple-200">
                                            <h3 className="font-bold text-lg mb-4 text-gray-800">Financing Structure</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Cash/Land Contribution %</label>
                                                    <input
                                                        type="number"
                                                        value={cashPercent}
                                                        onChange={(e) => setCashPercent(Number(e.target.value))}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                        min="0"
                                                        max="100"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Equity %</label>
                                                    <input
                                                        type="number"
                                                        value={equityPercent}
                                                        onChange={(e) => {
                                                            setEquityPercent(Number(e.target.value));
                                                            setDebtPercent(100 - Number(e.target.value));
                                                        }}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                        min="0"
                                                        max="100"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Debt %</label>
                                                    <input
                                                        type="number"
                                                        value={debtPercent}
                                                        onChange={(e) => {
                                                            setDebtPercent(Number(e.target.value));
                                                            setEquityPercent(100 - Number(e.target.value));
                                                        }}
                                                        className="input-cell w-full px-4 py-2 rounded-lg"
                                                        min="0"
                                                        max="100"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Financing Sources Tab */}
                                {activeTab === 'financing' && (
                                    <div className="space-y-6">
                                        <h2 className="text-2xl font-bold text-gray-800 mb-6">Financing Sources by Component</h2>
                                        
                                        <div className="space-y-6">
                                            {components.map((component) => {
                                                const areas = calculatedAreas[component.id];
                                                const buaValue = areas['bua'] || 0;
                                                const netArea = netDevelopableArea / components.length;
                                                const landValue = (totalLand / components.length) * 1000;
                                                
                                                const landCost = landValue * (cashPercent / 100);
                                                const infraCost = netArea * 500;
                                                const constructionCost = buaValue * 1500;
                                                const totalCost = landCost + infraCost + constructionCost;
                                                const equityCost = totalCost * (equityPercent / 100);
                                                const debtCost = totalCost * (debtPercent / 100);

                                                return (
                                                    <div key={component.id} className={`p-4 bg-${component.color}-50 rounded-lg`}>
                                                        <h4 className="font-bold text-lg mb-3">{component.name}</h4>
                                                        <div className="overflow-x-auto">
                                                            <table className="w-full text-sm bg-white rounded-lg overflow-hidden">
                                                                <thead>
                                                                    <tr className="bg-gray-700 text-white">
                                                                        <th className="p-2 text-left">Description</th>
                                                                        <th className="p-2 text-right">Total</th>
                                                                        <th className="p-2 text-right">Equity ({equityPercent}%)</th>
                                                                        <th className="p-2 text-right">Debt ({debtPercent}%)</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr className="bg-white">
                                                                        <td className="p-2 border">Land</td>
                                                                        <td className="p-2 border text-right">${formatNumber(landCost)}</td>
                                                                        <td className="p-2 border text-right text-green-600 font-semibold">
                                                                            ${formatNumber(landCost * (equityPercent / 100))}
                                                                        </td>
                                                                        <td className="p-2 border text-right text-red-600 font-semibold">
                                                                            ${formatNumber(landCost * (debtPercent / 100))}
                                                                        </td>
                                                                    </tr>
                                                                    <tr className="bg-gray-50">
                                                                        <td className="p-2 border">Infrastructure</td>
                                                                        <td className="p-2 border text-right">${formatNumber(infraCost)}</td>
                                                                        <td className="p-2 border text-right text-green-600 font-semibold">
                                                                            ${formatNumber(infraCost * (equityPercent / 100))}
                                                                        </td>
                                                                        <td className="p-2 border text-right text-red-600 font-semibold">
                                                                            ${formatNumber(infraCost * (debtPercent / 100))}
                                                                        </td>
                                                                    </tr>
                                                                    <tr className="bg-white">
                                                                        <td className="p-2 border">Construction</td>
                                                                        <td className="p-2 border text-right">${formatNumber(constructionCost)}</td>
                                                                        <td className="p-2 border text-right text-green-600 font-semibold">
                                                                            ${formatNumber(constructionCost * (equityPercent / 100))}
                                                                        </td>
                                                                        <td className="p-2 border text-right text-red-600 font-semibold">
                                                                            ${formatNumber(constructionCost * (debtPercent / 100))}
                                                                        </td>
                                                                    </tr>
                                                                    <tr className={`bg-${component.color}-600 text-white font-bold`}>
                                                                        <td className="p-3">TOTAL</td>
                                                                        <td className="p-3 text-right">${formatNumber(totalCost)}</td>
                                                                        <td className="p-3 text-right">${formatNumber(equityCost)}</td>
                                                                        <td className="p-3 text-right">${formatNumber(debtCost)}</td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<RealEstatePlatform />, document.getElementById('root'));
    </script>
</body>
</html>
