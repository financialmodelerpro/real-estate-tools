<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Financial Modeling Platform - Development Costs</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-active { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
        }
        .module-card { 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.07); 
            transition: all 0.3s; 
        }
        .module-card:hover { 
            box-shadow: 0 10px 20px rgba(0,0,0,0.12); 
            transform: translateY(-2px); 
        }
        .gradient-bg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        input[type="number"], input[type="text"], input[type="date"], select { 
            transition: all 0.2s; 
        }
        input:focus, select:focus { 
            outline: none; 
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            transition: all 0.3s; 
        }
        .btn-primary:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); 
        }
        .table-container {
            overflow-x: auto;
            max-width: 100%;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            font-size: 0.875rem;
        }
        th {
            position: sticky;
            top: 0;
            background: #1f2937;
            color: white;
            font-weight: 600;
            padding: 0.75rem;
            text-align: center;
            border: 1px solid #374151;
            z-index: 10;
        }
        td {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            text-align: right;
        }
        td:first-child {
            text-align: left;
            font-weight: 500;
            position: sticky;
            left: 0;
            background: white;
            z-index: 5;
        }
        .total-row {
            background: #dbeafe;
            font-weight: 700;
        }
        .total-row td:first-child {
            background: #dbeafe;
        }
        .sticky-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .input-assumption {
            background-color: #fef3c7 !important;
            color: #1e40af !important;
            font-weight: 600;
            border: 1px solid #fbbf24 !important;
        }
        .editable-label {
            background-color: #fef3c7;
            color: #1e40af;
            font-weight: 600;
            border: 1px solid #fbbf24;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #1f2937;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            line-height: 1.4;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .cost-input-table td {
            text-align: left;
            padding: 0.5rem;
        }
        .cost-input-table input, .cost-input-table select {
            width: 100%;
            padding: 0.375rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.875rem;
        }
        .validation-error {
            color: #dc2626;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function RealEstatePlatform() {
            const [activeModule, setActiveModule] = useState('land');

            // ============ MODULE 1: LAND & AREA - ALL STATE PRESERVED ============
            const [totalLandArea, setTotalLandArea] = useState(500000);
            const [landPricePerSqm, setLandPricePerSqm] = useState(1200);
            const [allowedBuildingHeight, setAllowedBuildingHeight] = useState(25);
            const [averageFloorHeight, setAverageFloorHeight] = useState(3.5);
            const [site1Area, setSite1Area] = useState(250000);
            const [site2Area, setSite2Area] = useState(150000);
            const [site3Area, setSite3Area] = useState(100000);
            const [cashPercent, setCashPercent] = useState(15);
            const [site1Name, setSite1Name] = useState('Site 1');
            const [site2Name, setSite2Name] = useState('Site 2');
            const [site3Name, setSite3Name] = useState('Site 3');
            
            const [residentialPercent, setResidentialPercent] = useState(60);
            const [officePercent, setOfficePercent] = useState(15);
            const [hospitalityPercent, setHospitalityPercent] = useState(10);
            const [retailPercent, setRetailPercent] = useState(15);
            
            const [residentialEfficiency, setResidentialEfficiency] = useState(85);
            const [officeEfficiency, setOfficeEfficiency] = useState(80);
            const [hospitalityEfficiency, setHospitalityEfficiency] = useState(75);
            const [retailEfficiency, setRetailEfficiency] = useState(70);

            // Timeline settings
            const [projectType, setProjectType] = useState('residential');
            const [modelType, setModelType] = useState('monthly');
            const [constructionPeriods, setConstructionPeriods] = useState(24);
            const [operationPeriods, setOperationPeriods] = useState(120);
            const [exitPeriod, setExitPeriod] = useState(144);

            // ============ MODULE 2: DEVELOPMENT COSTS - RESIDENTIAL STATE ============
            const [residentialCosts, setResidentialCosts] = useState([]);
            const [nextCostId, setNextCostId] = useState(6);

            // Initialize default residential costs
            useEffect(() => {
                if (residentialCosts.length === 0) {
                    const cashLandArea = totalLandArea * (cashPercent / 100);
                    const totalCashLandValue = cashLandArea * landPricePerSqm;
                    const residentialLandCost = totalCashLandValue * (residentialPercent / 100);

                    setResidentialCosts([
                        {
                            id: 1,
                            name: 'Land (Cash Portion)',
                            method: 'fixed',
                            value: residentialLandCost,
                            baseType: '',
                            startPeriod: 0,
                            endPeriod: 0,
                            phasing: '100',
                            canDelete: false
                        },
                        {
                            id: 2,
                            name: 'Infrastructure Development',
                            method: 'rate_total_area',
                            value: 150,
                            baseType: '',
                            startPeriod: 1,
                            endPeriod: 6,
                            phasing: '30,25,20,15,7,3',
                            canDelete: true
                        },
                        {
                            id: 3,
                            name: 'Construction Cost',
                            method: 'rate_bua',
                            value: 1200,
                            baseType: '',
                            startPeriod: 7,
                            endPeriod: 24,
                            phasing: 'even',
                            canDelete: true
                        },
                        {
                            id: 4,
                            name: 'Professional Fees',
                            method: 'percent_base',
                            value: 5,
                            baseType: 'infra_construction',
                            startPeriod: 1,
                            endPeriod: 24,
                            phasing: 'even',
                            canDelete: true
                        },
                        {
                            id: 5,
                            name: 'Contingency',
                            method: 'percent_base',
                            value: 3,
                            baseType: 'all_previous',
                            startPeriod: 1,
                            endPeriod: 24,
                            phasing: 'even',
                            canDelete: true
                        }
                    ]);
                }
            }, []);

            // Update Land cost when dependencies change
            useEffect(() => {
                if (residentialCosts.length > 0) {
                    const cashLandArea = totalLandArea * (cashPercent / 100);
                    const totalCashLandValue = cashLandArea * landPricePerSqm;
                    const residentialLandCost = totalCashLandValue * (residentialPercent / 100);

                    setResidentialCosts(prev => prev.map(cost => 
                        cost.id === 1 ? { ...cost, value: residentialLandCost } : cost
                    ));
                }
            }, [totalLandArea, landPricePerSqm, cashPercent, residentialPercent]);

            // Calculate areas from Land & Area tab
            const cashLandArea = totalLandArea * (cashPercent / 100);
            const residentialTotalArea = cashLandArea * (residentialPercent / 100);
            const residentialNetArea = residentialTotalArea * 0.7;
            const maxFloors = Math.floor(allowedBuildingHeight / averageFloorHeight);
            const residentialGFA = residentialNetArea * maxFloors;
            const residentialBUA = residentialGFA * (residentialEfficiency / 100);

            const hospitalityTotalArea = cashLandArea * (hospitalityPercent / 100);
            const hospitalityNetArea = hospitalityTotalArea * 0.7;
            const hospitalityGFA = hospitalityNetArea * maxFloors;
            const hospitalityBUA = hospitalityGFA * (hospitalityEfficiency / 100);

            const retailTotalArea = cashLandArea * (retailPercent / 100);
            const retailNetArea = retailTotalArea * 0.7;
            const retailGFA = retailNetArea * maxFloors;
            const retailBUA = retailGFA * (retailEfficiency / 100);

            // Helper function to format numbers
            const formatNumber = (num) => {
                if (!num && num !== 0) return '0';
                return new Intl.NumberFormat('en-US', { 
                    minimumFractionDigits: 0, 
                    maximumFractionDigits: 0 
                }).format(num);
            };

            // Calculate total cost for a cost item
            const calculateItemTotal = (cost, assetType = 'residential') => {
                const areas = {
                    residential: {
                        total: residentialTotalArea,
                        net: residentialNetArea,
                        gfa: residentialGFA,
                        bua: residentialBUA
                    },
                    hospitality: {
                        total: hospitalityTotalArea,
                        net: hospitalityNetArea,
                        gfa: hospitalityGFA,
                        bua: hospitalityBUA
                    },
                    retail: {
                        total: retailTotalArea,
                        net: retailNetArea,
                        gfa: retailGFA,
                        bua: retailBUA
                    }
                };

                const area = areas[assetType];

                switch (cost.method) {
                    case 'fixed':
                        return parseFloat(cost.value) || 0;
                    case 'rate_total_area':
                        return (parseFloat(cost.value) || 0) * area.total;
                    case 'rate_net_area':
                        return (parseFloat(cost.value) || 0) * area.net;
                    case 'rate_gfa':
                        return (parseFloat(cost.value) || 0) * area.gfa;
                    case 'rate_bua':
                        return (parseFloat(cost.value) || 0) * area.bua;
                    case 'percent_base':
                        return calculatePercentBase(cost, assetType);
                    default:
                        return 0;
                }
            };

            // Calculate percentage of base costs
            const calculatePercentBase = (cost, assetType = 'residential') => {
                const costs = assetType === 'residential' ? residentialCosts : [];
                let baseTotal = 0;

                switch (cost.baseType) {
                    case 'infrastructure_only':
                        const infraCost = costs.find(c => c.name.toLowerCase().includes('infrastructure'));
                        if (infraCost && infraCost.id !== cost.id) {
                            baseTotal = calculateItemTotal(infraCost, assetType);
                        }
                        break;
                    case 'construction_only':
                        const constrCost = costs.find(c => c.name.toLowerCase().includes('construction'));
                        if (constrCost && constrCost.id !== cost.id) {
                            baseTotal = calculateItemTotal(constrCost, assetType);
                        }
                        break;
                    case 'infra_construction':
                        const infra = costs.find(c => c.name.toLowerCase().includes('infrastructure'));
                        const constr = costs.find(c => c.name.toLowerCase().includes('construction'));
                        if (infra && infra.id !== cost.id) baseTotal += calculateItemTotal(infra, assetType);
                        if (constr && constr.id !== cost.id) baseTotal += calculateItemTotal(constr, assetType);
                        break;
                    case 'all_previous':
                        const currentIndex = costs.findIndex(c => c.id === cost.id);
                        if (currentIndex > 0) {
                            baseTotal = costs.slice(0, currentIndex).reduce((sum, c) => 
                                sum + calculateItemTotal(c, assetType), 0);
                        }
                        break;
                    default:
                        baseTotal = 0;
                }

                return baseTotal * ((parseFloat(cost.value) || 0) / 100);
            };

            // Validate phasing
            const validatePhasing = (phasing, startPeriod, endPeriod) => {
                if (phasing.toLowerCase() === 'even') return { valid: true, error: '' };

                const periods = endPeriod - startPeriod + 1;
                const values = phasing.split(',').map(v => parseFloat(v.trim())).filter(v => !isNaN(v));

                if (values.length !== periods) {
                    return { 
                        valid: false, 
                        error: `Must have ${periods} values (one per period)` 
                    };
                }

                const sum = values.reduce((a, b) => a + b, 0);
                if (Math.abs(sum - 100) > 0.01) {
                    return { 
                        valid: false, 
                        error: `Sum is ${sum.toFixed(1)}% (must be 100%)` 
                    };
                }

                return { valid: true, error: '' };
            };

            // Distribute cost across periods based on phasing
            const distributeCost = (cost, assetType = 'residential') => {
                const total = calculateItemTotal(cost, assetType);
                const distribution = Array(constructionPeriods + 1).fill(0);

                if (cost.phasing.toLowerCase() === 'even') {
                    const periods = cost.endPeriod - cost.startPeriod + 1;
                    const amountPerPeriod = total / periods;
                    for (let i = cost.startPeriod; i <= cost.endPeriod && i <= constructionPeriods; i++) {
                        distribution[i] = amountPerPeriod;
                    }
                } else {
                    const percentages = cost.phasing.split(',').map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
                    percentages.forEach((pct, idx) => {
                        const period = cost.startPeriod + idx;
                        if (period <= constructionPeriods) {
                            distribution[period] = total * (pct / 100);
                        }
                    });
                }

                return distribution;
            };

            // Add new cost item
            const addResidentialCost = () => {
                const newCost = {
                    id: nextCostId,
                    name: 'New Cost Item',
                    method: 'fixed',
                    value: 0,
                    baseType: '',
                    startPeriod: 1,
                    endPeriod: constructionPeriods,
                    phasing: 'even',
                    canDelete: true
                };
                setResidentialCosts([...residentialCosts, newCost]);
                setNextCostId(nextCostId + 1);
            };

            // Delete cost item
            const deleteResidentialCost = (id) => {
                setResidentialCosts(residentialCosts.filter(c => c.id !== id));
            };

            // Update cost item
            const updateResidentialCost = (id, field, value) => {
                setResidentialCosts(residentialCosts.map(cost => 
                    cost.id === id ? { ...cost, [field]: value } : cost
                ));
            };

            // Calculate CAPEX summary
            const calculateResidentialCapex = () => {
                const summary = residentialCosts.map(cost => ({
                    name: cost.name,
                    total: calculateItemTotal(cost, 'residential'),
                    distribution: distributeCost(cost, 'residential')
                }));

                // Calculate totals per period
                const periodTotals = Array(constructionPeriods + 1).fill(0);
                summary.forEach(item => {
                    item.distribution.forEach((amount, period) => {
                        periodTotals[period] += amount;
                    });
                });

                return { items: summary, totals: periodTotals };
            };

            const residentialCapex = calculateResidentialCapex();

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <div className="gradient-bg text-white p-6 shadow-lg">
                        <div className="max-w-7xl mx-auto">
                            <h1 className="text-3xl font-bold">Real Estate Financial Modeling Platform</h1>
                            <p className="mt-2 text-blue-100">Comprehensive Development Analysis Tool</p>
                        </div>
                    </div>

                    {/* Module Navigation */}
                    <div className="sticky-nav">
                        <div className="max-w-7xl mx-auto px-6 py-4">
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setActiveModule('land')}
                                    className={`px-6 py-2 rounded-lg font-semibold transition-all ${
                                        activeModule === 'land' ? 'tab-active' : 'bg-gray-200 hover:bg-gray-300'
                                    }`}
                                >
                                    Land & Area
                                </button>
                                <button
                                    onClick={() => setActiveModule('devcosts')}
                                    className={`px-6 py-2 rounded-lg font-semibold transition-all ${
                                        activeModule === 'devcosts' ? 'tab-active' : 'bg-gray-200 hover:bg-gray-300'
                                    }`}
                                >
                                    Development Costs
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="max-w-7xl mx-auto px-6 py-8">
                        {activeModule === 'land' && (
                            <div className="space-y-6">
                                {/* Timeline Tab */}
                                <div className="module-card p-6">
                                    <h2 className="text-2xl font-bold mb-6 text-gray-800">Project Timeline & Model Settings</h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <label className="block text-sm font-semibold mb-2">Project Type</label>
                                            <select 
                                                value={projectType}
                                                onChange={(e) => setProjectType(e.target.value)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg"
                                            >
                                                <option value="residential">Residential</option>
                                                <option value="hospitality">Hospitality</option>
                                                <option value="mixed">Mixed-Use Development</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2">Model Type</label>
                                            <select 
                                                value={modelType}
                                                onChange={(e) => setModelType(e.target.value)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg"
                                            >
                                                <option value="monthly">Monthly</option>
                                                <option value="annual">Annual</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2">
                                                Construction Periods ({modelType === 'monthly' ? 'Months' : 'Years'})
                                            </label>
                                            <input
                                                type="number"
                                                value={constructionPeriods}
                                                onChange={(e) => setConstructionPeriods(parseInt(e.target.value) || 0)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2">
                                                Operation Periods ({modelType === 'monthly' ? 'Months' : 'Years'})
                                            </label>
                                            <input
                                                type="number"
                                                value={operationPeriods}
                                                onChange={(e) => setOperationPeriods(parseInt(e.target.value) || 0)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2">
                                                Exit Period ({modelType === 'monthly' ? 'Month' : 'Year'})
                                            </label>
                                            <input
                                                type="number"
                                                value={exitPeriod}
                                                onChange={(e) => setExitPeriod(parseInt(e.target.value) || 0)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                            />
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <h3 className="font-semibold text-blue-900 mb-2">Timeline Summary</h3>
                                        <div className="grid grid-cols-3 gap-4 text-sm">
                                            <div>
                                                <span className="text-blue-700">Construction:</span>
                                                <span className="font-semibold ml-2">
                                                    {constructionPeriods} {modelType === 'monthly' ? 'months' : 'years'}
                                                </span>
                                            </div>
                                            <div>
                                                <span className="text-blue-700">Operation:</span>
                                                <span className="font-semibold ml-2">
                                                    {operationPeriods} {modelType === 'monthly' ? 'months' : 'years'}
                                                </span>
                                            </div>
                                            <div>
                                                <span className="text-blue-700">Exit at:</span>
                                                <span className="font-semibold ml-2">
                                                    {modelType === 'monthly' ? 'Month' : 'Year'} {exitPeriod}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Land & Area Content - Keeping existing implementation */}
                                <div className="module-card p-6">
                                    <h2 className="text-2xl font-bold mb-6 text-gray-800">Land Acquisition & Area Analysis</h2>
                                    
                                    {/* Basic Land Inputs */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                                        <div>
                                            <label className="block text-sm font-semibold mb-2">Total Land Area (SQM)</label>
                                            <input
                                                type="number"
                                                value={totalLandArea}
                                                onChange={(e) => setTotalLandArea(parseFloat(e.target.value) || 0)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2">Land Price ($/SQM)</label>
                                            <input
                                                type="number"
                                                value={landPricePerSqm}
                                                onChange={(e) => setLandPricePerSqm(parseFloat(e.target.value) || 0)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2">Cash Purchase %</label>
                                            <input
                                                type="number"
                                                value={cashPercent}
                                                onChange={(e) => setCashPercent(parseFloat(e.target.value) || 0)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2">Total Land Value</label>
                                            <div className="w-full p-3 bg-gray-100 rounded-lg font-bold text-lg">
                                                ${formatNumber(totalLandArea * landPricePerSqm)}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Site Breakdown */}
                                    <div className="bg-gray-50 p-4 rounded-lg mb-6">
                                        <h3 className="font-semibold mb-4">Site Breakdown</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            {[
                                                { name: site1Name, setName: setSite1Name, area: site1Area, setArea: setSite1Area },
                                                { name: site2Name, setName: setSite2Name, area: site2Area, setArea: setSite2Area },
                                                { name: site3Name, setName: setSite3Name, area: site3Area, setArea: setSite3Area }
                                            ].map((site, idx) => (
                                                <div key={idx} className="bg-white p-3 rounded">
                                                    <input
                                                        type="text"
                                                        value={site.name}
                                                        onChange={(e) => site.setName(e.target.value)}
                                                        className="w-full mb-2 p-2 border rounded editable-label"
                                                    />
                                                    <input
                                                        type="number"
                                                        value={site.area}
                                                        onChange={(e) => site.setArea(parseFloat(e.target.value) || 0)}
                                                        className="w-full p-2 border rounded input-assumption"
                                                    />
                                                    <div className="text-xs text-gray-600 mt-1">
                                                        {((site.area / totalLandArea) * 100).toFixed(1)}% of total
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Building Parameters */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <label className="block text-sm font-semibold mb-2">Allowed Building Height (M)</label>
                                            <input
                                                type="number"
                                                value={allowedBuildingHeight}
                                                onChange={(e) => setAllowedBuildingHeight(parseFloat(e.target.value) || 0)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold mb-2">Average Floor Height (M)</label>
                                            <input
                                                type="number"
                                                value={averageFloorHeight}
                                                onChange={(e) => setAverageFloorHeight(parseFloat(e.target.value) || 0)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                            />
                                        </div>
                                    </div>

                                    {/* Asset Mix - Show based on project type */}
                                    {(projectType === 'residential' || projectType === 'mixed') && (
                                        <div className="mb-6">
                                            <h3 className="font-semibold mb-4">
                                                {projectType === 'mixed' ? 'Asset Mix Allocation (%)' : 'Residential Allocation'}
                                            </h3>
                                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2">Residential %</label>
                                                    <input
                                                        type="number"
                                                        value={residentialPercent}
                                                        onChange={(e) => setResidentialPercent(parseFloat(e.target.value) || 0)}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                                        disabled={projectType === 'residential'}
                                                    />
                                                </div>

                                                {projectType === 'mixed' && (
                                                    <>
                                                        <div>
                                                            <label className="block text-sm font-semibold mb-2">Office %</label>
                                                            <input
                                                                type="number"
                                                                value={officePercent}
                                                                onChange={(e) => setOfficePercent(parseFloat(e.target.value) || 0)}
                                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                                            />
                                                        </div>

                                                        <div>
                                                            <label className="block text-sm font-semibold mb-2">Hospitality %</label>
                                                            <input
                                                                type="number"
                                                                value={hospitalityPercent}
                                                                onChange={(e) => setHospitalityPercent(parseFloat(e.target.value) || 0)}
                                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                                            />
                                                        </div>

                                                        <div>
                                                            <label className="block text-sm font-semibold mb-2">Retail %</label>
                                                            <input
                                                                type="number"
                                                                value={retailPercent}
                                                                onChange={(e) => setRetailPercent(parseFloat(e.target.value) || 0)}
                                                                className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                                            />
                                                        </div>
                                                    </>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {projectType === 'hospitality' && (
                                        <div className="mb-6">
                                            <h3 className="font-semibold mb-4">Hospitality Allocation</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2">Hospitality %</label>
                                                    <input
                                                        type="number"
                                                        value={hospitalityPercent}
                                                        onChange={(e) => setHospitalityPercent(parseFloat(e.target.value) || 0)}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                                        disabled
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Efficiency Rates */}
                                    <div className="mb-6">
                                        <h3 className="font-semibold mb-4">Efficiency Rates (%)</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                            {(projectType === 'residential' || projectType === 'mixed') && (
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2">Residential</label>
                                                    <input
                                                        type="number"
                                                        value={residentialEfficiency}
                                                        onChange={(e) => setResidentialEfficiency(parseFloat(e.target.value) || 0)}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                                    />
                                                </div>
                                            )}

                                            {projectType === 'mixed' && (
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2">Office</label>
                                                    <input
                                                        type="number"
                                                        value={officeEfficiency}
                                                        onChange={(e) => setOfficeEfficiency(parseFloat(e.target.value) || 0)}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                                    />
                                                </div>
                                            )}

                                            {(projectType === 'hospitality' || projectType === 'mixed') && (
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2">Hospitality</label>
                                                    <input
                                                        type="number"
                                                        value={hospitalityEfficiency}
                                                        onChange={(e) => setHospitalityEfficiency(parseFloat(e.target.value) || 0)}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                                    />
                                                </div>
                                            )}

                                            {projectType === 'mixed' && (
                                                <div>
                                                    <label className="block text-sm font-semibold mb-2">Retail</label>
                                                    <input
                                                        type="number"
                                                        value={retailEfficiency}
                                                        onChange={(e) => setRetailEfficiency(parseFloat(e.target.value) || 0)}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-lg input-assumption"
                                                    />
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Area Calculations Summary */}
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <h3 className="font-semibold text-blue-900 mb-4">Area Calculation Summary</h3>
                                        <div className="space-y-4">
                                            {(projectType === 'residential' || projectType === 'mixed') && (
                                                <div className="bg-white p-4 rounded">
                                                    <h4 className="font-semibold text-blue-800 mb-2">Residential</h4>
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                                        <div>
                                                            <div className="text-gray-600">Total Area</div>
                                                            <div className="font-semibold">{formatNumber(residentialTotalArea)} SQM</div>
                                                        </div>
                                                        <div>
                                                            <div className="text-gray-600">Net Area (70%)</div>
                                                            <div className="font-semibold">{formatNumber(residentialNetArea)} SQM</div>
                                                        </div>
                                                        <div>
                                                            <div className="text-gray-600">GFA ({maxFloors} floors)</div>
                                                            <div className="font-semibold">{formatNumber(residentialGFA)} SQM</div>
                                                        </div>
                                                        <div>
                                                            <div className="text-gray-600">BUA ({residentialEfficiency}% eff.)</div>
                                                            <div className="font-semibold">{formatNumber(residentialBUA)} SQM</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {projectType === 'hospitality' && (
                                                <div className="bg-white p-4 rounded">
                                                    <h4 className="font-semibold text-green-800 mb-2">Hospitality</h4>
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                                        <div>
                                                            <div className="text-gray-600">Total Area</div>
                                                            <div className="font-semibold">{formatNumber(hospitalityTotalArea)} SQM</div>
                                                        </div>
                                                        <div>
                                                            <div className="text-gray-600">Net Area (70%)</div>
                                                            <div className="font-semibold">{formatNumber(hospitalityNetArea)} SQM</div>
                                                        </div>
                                                        <div>
                                                            <div className="text-gray-600">GFA ({maxFloors} floors)</div>
                                                            <div className="font-semibold">{formatNumber(hospitalityGFA)} SQM</div>
                                                        </div>
                                                        <div>
                                                            <div className="text-gray-600">BUA ({hospitalityEfficiency}% eff.)</div>
                                                            <div className="font-semibold">{formatNumber(hospitalityBUA)} SQM</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {projectType === 'mixed' && (
                                                <>
                                                    <div className="bg-white p-4 rounded">
                                                        <h4 className="font-semibold text-green-800 mb-2">Hospitality</h4>
                                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                                            <div>
                                                                <div className="text-gray-600">Total Area</div>
                                                                <div className="font-semibold">{formatNumber(hospitalityTotalArea)} SQM</div>
                                                            </div>
                                                            <div>
                                                                <div className="text-gray-600">Net Area (70%)</div>
                                                                <div className="font-semibold">{formatNumber(hospitalityNetArea)} SQM</div>
                                                            </div>
                                                            <div>
                                                                <div className="text-gray-600">GFA ({maxFloors} floors)</div>
                                                                <div className="font-semibold">{formatNumber(hospitalityGFA)} SQM</div>
                                                            </div>
                                                            <div>
                                                                <div className="text-gray-600">BUA ({hospitalityEfficiency}% eff.)</div>
                                                                <div className="font-semibold">{formatNumber(hospitalityBUA)} SQM</div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div className="bg-white p-4 rounded">
                                                        <h4 className="font-semibold text-purple-800 mb-2">Retail</h4>
                                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                                            <div>
                                                                <div className="text-gray-600">Total Area</div>
                                                                <div className="font-semibold">{formatNumber(retailTotalArea)} SQM</div>
                                                            </div>
                                                            <div>
                                                                <div className="text-gray-600">Net Area (70%)</div>
                                                                <div className="font-semibold">{formatNumber(retailNetArea)} SQM</div>
                                                            </div>
                                                            <div>
                                                                <div className="text-gray-600">GFA ({maxFloors} floors)</div>
                                                                <div className="font-semibold">{formatNumber(retailGFA)} SQM</div>
                                                            </div>
                                                            <div>
                                                                <div className="text-gray-600">BUA ({retailEfficiency}% eff.)</div>
                                                                <div className="font-semibold">{formatNumber(retailBUA)} SQM</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* DEVELOPMENT COSTS MODULE */}
                        {activeModule === 'devcosts' && (
                            <div className="space-y-8">
                                {/* RESIDENTIAL DEVELOPMENT COSTS */}
                                {(projectType === 'residential' || projectType === 'mixed') && (
                                    <div className="module-card p-6">
                                        <div className="flex justify-between items-center mb-6">
                                            <h2 className="text-2xl font-bold text-blue-800">RESIDENTIAL DEVELOPMENT COSTS</h2>
                                            <button
                                                onClick={addResidentialCost}
                                                className="btn-primary text-white px-4 py-2 rounded-lg font-semibold"
                                            >
                                                + Add Cost Item
                                            </button>
                                        </div>

                                        {/* Cost Input Table */}
                                        <div className="overflow-x-auto mb-8">
                                            <table className="w-full cost-input-table">
                                                <thead>
                                                    <tr className="bg-gray-700 text-white">
                                                        <th className="p-3 text-left">Cost Item Name</th>
                                                        <th className="p-3 text-left">Calculation Method</th>
                                                        <th className="p-3 text-left">Value</th>
                                                        <th className="p-3 text-left">Base Cost Type</th>
                                                        <th className="p-3 text-center">Start Period</th>
                                                        <th className="p-3 text-center">End Period</th>
                                                        <th className="p-3 text-left">Phasing</th>
                                                        <th className="p-3 text-right">Total Cost</th>
                                                        <th className="p-3 text-center">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {residentialCosts.map((cost, idx) => {
                                                        const validation = validatePhasing(cost.phasing, cost.startPeriod, cost.endPeriod);
                                                        return (
                                                            <tr key={cost.id} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                                <td className="p-2">
                                                                    <input
                                                                        type="text"
                                                                        value={cost.name}
                                                                        onChange={(e) => updateResidentialCost(cost.id, 'name', e.target.value)}
                                                                        disabled={!cost.canDelete}
                                                                        className="w-full"
                                                                    />
                                                                </td>
                                                                <td className="p-2">
                                                                    <select
                                                                        value={cost.method}
                                                                        onChange={(e) => updateResidentialCost(cost.id, 'method', e.target.value)}
                                                                        disabled={!cost.canDelete}
                                                                    >
                                                                        <option value="fixed">Fixed Amount</option>
                                                                        <option value="rate_total_area">Rate per SQM - Total Area</option>
                                                                        <option value="rate_net_area">Rate per SQM - Net Area</option>
                                                                        <option value="rate_gfa">Rate per SQM - GFA</option>
                                                                        <option value="rate_bua">Rate per SQM - BUA</option>
                                                                        <option value="percent_base">% of Base Costs</option>
                                                                    </select>
                                                                </td>
                                                                <td className="p-2">
                                                                    <div className="flex items-center">
                                                                        {cost.method === 'percent_base' && <span className="mr-1">%</span>}
                                                                        {cost.method.startsWith('rate_') && <span className="mr-1">$</span>}
                                                                        <input
                                                                            type="number"
                                                                            value={cost.value}
                                                                            onChange={(e) => updateResidentialCost(cost.id, 'value', parseFloat(e.target.value) || 0)}
                                                                            disabled={cost.id === 1}
                                                                            className="w-full"
                                                                        />
                                                                        {cost.method.startsWith('rate_') && <span className="ml-1">/sqm</span>}
                                                                    </div>
                                                                </td>
                                                                <td className="p-2">
                                                                    {cost.method === 'percent_base' ? (
                                                                        <select
                                                                            value={cost.baseType}
                                                                            onChange={(e) => updateResidentialCost(cost.id, 'baseType', e.target.value)}
                                                                        >
                                                                            <option value="infrastructure_only">Infrastructure Only</option>
                                                                            <option value="construction_only">Construction Only</option>
                                                                            <option value="infra_construction">Infra + Construction</option>
                                                                            <option value="all_previous">All Previous Costs</option>
                                                                        </select>
                                                                    ) : (
                                                                        <span className="text-gray-400">N/A</span>
                                                                    )}
                                                                </td>
                                                                <td className="p-2 text-center">
                                                                    <input
                                                                        type="number"
                                                                        value={cost.startPeriod}
                                                                        onChange={(e) => updateResidentialCost(cost.id, 'startPeriod', parseInt(e.target.value) || 0)}
                                                                        min="0"
                                                                        max={constructionPeriods}
                                                                        disabled={cost.id === 1}
                                                                        className="w-20 text-center"
                                                                    />
                                                                </td>
                                                                <td className="p-2 text-center">
                                                                    <input
                                                                        type="number"
                                                                        value={cost.endPeriod}
                                                                        onChange={(e) => updateResidentialCost(cost.id, 'endPeriod', parseInt(e.target.value) || 0)}
                                                                        min="0"
                                                                        max={constructionPeriods}
                                                                        disabled={cost.id === 1}
                                                                        className="w-20 text-center"
                                                                    />
                                                                </td>
                                                                <td className="p-2">
                                                                    <input
                                                                        type="text"
                                                                        value={cost.phasing}
                                                                        onChange={(e) => updateResidentialCost(cost.id, 'phasing', e.target.value)}
                                                                        disabled={cost.id === 1}
                                                                        className="w-full"
                                                                        placeholder="30,25,20,15,7,3 or 'even'"
                                                                    />
                                                                    {!validation.valid && (
                                                                        <div className="validation-error">{validation.error}</div>
                                                                    )}
                                                                </td>
                                                                <td className="p-2 text-right font-semibold">
                                                                    ${formatNumber(calculateItemTotal(cost, 'residential'))}
                                                                </td>
                                                                <td className="p-2 text-center">
                                                                    {cost.canDelete && (
                                                                        <button
                                                                            onClick={() => deleteResidentialCost(cost.id)}
                                                                            className="text-red-600 hover:text-red-800 text-xl"
                                                                        >
                                                                            
                                                                        </button>
                                                                    )}
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        </div>

                                        {/* CAPEX Summary Table */}
                                        <div>
                                            <h3 className="text-xl font-bold text-blue-800 mb-4">RESIDENTIAL CAPEX SUMMARY</h3>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-sm">
                                                    <thead>
                                                        <tr className="bg-gray-700 text-white">
                                                            <th className="p-3 text-left">Description</th>
                                                            <th className="p-3 text-right">Total</th>
                                                            {Array.from({ length: constructionPeriods + 1 }, (_, i) => (
                                                                <th key={i} className="p-3 text-right whitespace-nowrap">
                                                                    {modelType === 'monthly' ? 'Month' : 'Year'} {i}
                                                                </th>
                                                            ))}
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {residentialCapex.items.map((item, idx) => (
                                                            <tr key={idx} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                                <td className="p-2 font-medium">{item.name}</td>
                                                                <td className="p-2 text-right font-semibold">
                                                                    ${formatNumber(item.total)}
                                                                </td>
                                                                {item.distribution.map((amount, periodIdx) => (
                                                                    <td key={periodIdx} className="p-2 text-right">
                                                                        {amount > 0 ? `$${formatNumber(amount)}` : '-'}
                                                                    </td>
                                                                ))}
                                                            </tr>
                                                        ))}
                                                        <tr className="total-row">
                                                            <td className="p-3 font-bold">TOTAL CAPEX</td>
                                                            <td className="p-3 text-right font-bold">
                                                                ${formatNumber(residentialCapex.totals.reduce((a, b) => a + b, 0))}
                                                            </td>
                                                            {residentialCapex.totals.map((total, idx) => (
                                                                <td key={idx} className="p-3 text-right font-bold">
                                                                    {total > 0 ? `$${formatNumber(total)}` : '-'}
                                                                </td>
                                                            ))}
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Placeholder for Hospitality - Will be added after testing */}
                                {(projectType === 'hospitality' || projectType === 'mixed') && (
                                    <div className="module-card p-6">
                                        <h2 className="text-2xl font-bold text-green-800 mb-4">HOSPITALITY DEVELOPMENT COSTS</h2>
                                        <div className="bg-green-50 p-8 rounded-lg text-center">
                                            <p className="text-green-700 font-semibold">Coming after Residential testing is complete</p>
                                        </div>
                                    </div>
                                )}

                                {/* Placeholder for Retail - Will be added after Hospitality */}
                                {projectType === 'mixed' && (
                                    <div className="module-card p-6">
                                        <h2 className="text-2xl font-bold text-purple-800 mb-4">RETAIL DEVELOPMENT COSTS</h2>
                                        <div className="bg-purple-50 p-8 rounded-lg text-center">
                                            <p className="text-purple-700 font-semibold">Coming after Hospitality testing is complete</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<RealEstatePlatform />, document.getElementById('root'));
    </script>
</body>
</html>
